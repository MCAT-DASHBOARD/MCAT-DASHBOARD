<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dr. Bob's MCAT ¬∑ Live</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=DM+Sans:ital,wght@0,400;0,500;0,600;0,700;0,800;1,400&display=swap');
:root{
  --bg:#141414;--bg2:#1c1c1c;--bg3:#242424;--bg4:#2e2e2e;
  --border:#2e2e2e;--text:#f0ece4;--sub:#7a7060;--dim:#1e1e1e;
  --green:#00dd88;--amber:#ffaa00;--red:#ff5050;
  --blue:#5599ff;--purple:#b088ff;--cyan:#00ccdd;--hot:#ff6b35;
}
*{box-sizing:border-box;margin:0;padding:0;}
body{background:var(--bg);color:var(--text);font-family:'DM Sans',sans-serif;min-height:100vh;}

/* HEADER */
header{padding:14px 24px;background:var(--bg2);border-bottom:1px solid var(--border);
  display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;
  position:sticky;top:0;z-index:100;}
.logo{display:flex;align-items:center;gap:12px;}
.logo-box{width:42px;height:42px;border-radius:8px;background:linear-gradient(135deg,#2a1f00,#3d2e00);
  border:1px solid rgba(255,170,0,0.3);display:flex;align-items:center;justify-content:center;
  font-family:'Space Mono',monospace;font-size:10px;font-weight:700;color:var(--amber);}
.logo-text h1{font-size:17px;font-weight:800;letter-spacing:-0.3px;}
.logo-text h1 span{color:var(--amber);}
.logo-text .sub{font-size:10px;font-family:'Space Mono',monospace;color:var(--sub);margin-top:2px;}
.vb{font-size:8px;background:rgba(255,170,0,0.12);color:var(--amber);padding:2px 6px;
  border-radius:3px;margin-left:6px;font-family:'Space Mono',monospace;vertical-align:middle;}
.hdr-right{display:flex;align-items:center;gap:8px;flex-wrap:wrap;}
.status-pill{display:flex;align-items:center;gap:6px;background:var(--bg3);
  border:1px solid var(--border);border-radius:6px;padding:6px 12px;}
.status-dot{width:7px;height:7px;border-radius:50%;}
.status-dot.live{background:var(--green);box-shadow:0 0 8px var(--green);animation:pulse 2s infinite;}
.status-dot.fetching{background:var(--amber);animation:pulse .5s infinite;}
.status-dot.stale{background:var(--amber);}
.status-dot.error{background:var(--red);}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}
.status-text{font-size:10px;font-family:'Space Mono',monospace;color:var(--sub);}
.refresh-btn{display:flex;align-items:center;gap:6px;background:var(--bg3);border:1px solid var(--border);
  border-radius:6px;padding:6px 14px;cursor:pointer;font-size:11px;font-family:'Space Mono',monospace;
  color:var(--text);transition:all .15s;}
.refresh-btn:hover{border-color:var(--amber);color:var(--amber);}
@keyframes spin{to{transform:rotate(360deg)}}
.spinning{animation:spin .8s linear infinite;display:inline-block;}

/* GUIDE BAR */
.guide-wrap{position:relative;}
.guide-bar{padding:9px 24px;background:var(--bg2);border-bottom:1px solid var(--border);
  display:flex;align-items:center;gap:10px;cursor:pointer;user-select:none;}
.guide-bar:hover{background:#202020;}
.guide-label{font-size:9px;font-family:'Space Mono',monospace;color:var(--sub);letter-spacing:2px;}
.guide-hint{font-size:10px;color:var(--sub);margin-left:auto;opacity:.6;}
.guide-panel{display:none;position:absolute;top:100%;left:0;right:0;z-index:90;
  background:#1a1a1a;border-bottom:2px solid rgba(255,170,0,0.4);
  padding:20px 24px;box-shadow:0 8px 32px rgba(0,0,0,0.5);}
.guide-bar:hover .guide-panel{display:block;}
.guide-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:14px;}
.guide-section{background:var(--bg3);border:1px solid var(--border);border-radius:8px;padding:14px 16px;}
.guide-section h4{font-size:9px;font-family:'Space Mono',monospace;letter-spacing:1.5px;margin-bottom:10px;}
.guide-row{display:flex;gap:8px;margin-bottom:8px;align-items:flex-start;font-size:11px;line-height:1.55;color:#b8b0a4;}
.gk{font-family:'Space Mono',monospace;font-size:8px;padding:3px 7px;border-radius:3px;flex-shrink:0;margin-top:2px;white-space:nowrap;}

/* GATE */
.gate{margin:14px 24px;background:var(--bg2);border:1px solid #3a3020;
  border-left:4px solid var(--amber);border-radius:10px;overflow:hidden;}
.gate-top{padding:12px 18px;background:rgba(255,170,0,0.05);border-bottom:1px solid rgba(255,170,0,0.12);
  display:flex;align-items:center;gap:12px;flex-wrap:wrap;}
.gate-led{width:9px;height:9px;border-radius:50%;flex-shrink:0;}
.gate-led.open{background:var(--amber);box-shadow:0 0 10px var(--amber);animation:pulse 2s infinite;}
.gate-led.closed{background:var(--sub);}
.gate-led.warning{background:var(--red);box-shadow:0 0 10px var(--red);animation:pulse 1s infinite;}
.gate-eyebrow{font-size:9px;font-family:'Space Mono',monospace;color:var(--sub);letter-spacing:2px;}

/* Gate status with tooltip */
.gate-status-wrap{position:relative;display:inline-block;}
.gate-status{font-size:14px;font-weight:800;cursor:help;border-bottom:1px dashed rgba(255,255,255,0.2);}
.gate-tooltip{display:none;position:absolute;top:calc(100% + 8px);left:0;z-index:200;
  background:#1a1a1a;border:1px solid var(--border);border-radius:8px;
  padding:14px 16px;width:320px;box-shadow:0 8px 24px rgba(0,0,0,0.6);font-size:11px;line-height:1.6;}
.gate-status-wrap:hover .gate-tooltip{display:block;}
.gt-row{display:flex;gap:8px;margin-bottom:8px;align-items:flex-start;color:#b8b0a4;}
.gt-key{font-family:'Space Mono',monospace;font-size:8px;padding:2px 6px;border-radius:3px;
  flex-shrink:0;margin-top:2px;white-space:nowrap;}

.gate-body{padding:14px 18px;display:flex;align-items:flex-start;gap:20px;flex-wrap:wrap;}
.gate-desc{font-size:12px;line-height:1.7;max-width:500px;opacity:.85;flex:1;min-width:200px;}
.gate-readings{display:flex;gap:12px;flex-shrink:0;flex-wrap:wrap;}
.reading{background:var(--bg3);border:1px solid var(--border);border-radius:8px;
  padding:12px 16px;text-align:center;min-width:82px;}
.reading-label{font-size:8px;font-family:'Space Mono',monospace;color:var(--sub);letter-spacing:1px;margin-bottom:6px;}
.reading-val{font-size:28px;font-weight:800;font-family:'Space Mono',monospace;line-height:1;}
.reading-trend{font-size:22px;font-weight:700;margin-top:4px;line-height:1;}
.reading-sub{font-size:9px;font-family:'Space Mono',monospace;margin-top:5px;padding:2px 6px;
  border-radius:3px;display:inline-block;}
.rsub-floor{background:rgba(0,221,136,0.12);color:var(--green);}
.rsub-low{background:rgba(255,170,0,0.12);color:var(--amber);}
.rsub-mid{background:rgba(85,153,255,0.12);color:var(--blue);}
.rsub-high{background:rgba(255,80,80,0.12);color:var(--red);}
.rsub-peak{background:rgba(255,80,80,0.2);color:var(--red);font-weight:700;}

/* SECTION BARS */
.sec-bar{padding:0;border-top:2px solid transparent;border-bottom:1px solid var(--border);
  display:flex;align-items:stretch;flex-wrap:wrap;position:relative;}
.sec-bar-inner{display:flex;align-items:center;gap:10px;flex:1;padding:11px 20px;flex-wrap:wrap;}
.sec-tag{font-size:10px;font-family:'Space Mono',monospace;font-weight:700;
  padding:3px 10px;border-radius:4px;letter-spacing:1px;white-space:nowrap;}
/* HOT */
.sec-bar-hot{background:linear-gradient(90deg,rgba(255,107,53,0.18),rgba(255,107,53,0.04));border-top-color:var(--hot);}
.sec-tag-hot{background:rgba(255,107,53,0.25);color:var(--hot);}
.sec-bar-hot .sec-tickers{color:rgba(255,107,53,0.6);}
/* REFERENCE */
.sec-bar-ref{background:linear-gradient(90deg,rgba(122,112,96,0.14),rgba(122,112,96,0.03));border-top-color:#5a5248;}
.sec-tag-ref{background:rgba(122,112,96,0.2);color:#a09080;}
.sec-bar-ref .sec-tickers{color:rgba(160,144,128,0.6);}
/* CORE */
.sec-bar-core{background:linear-gradient(90deg,rgba(255,170,0,0.15),rgba(255,170,0,0.03));border-top-color:var(--amber);}
.sec-tag-core{background:rgba(255,170,0,0.22);color:var(--amber);}
.sec-bar-core .sec-tickers{color:rgba(255,170,0,0.65);}
/* TIER 1 */
.sec-bar-t1{background:linear-gradient(90deg,rgba(85,153,255,0.14),rgba(85,153,255,0.03));border-top-color:var(--blue);}
.sec-tag-t1{background:rgba(85,153,255,0.2);color:var(--blue);}
.sec-bar-t1 .sec-tickers{color:rgba(85,153,255,0.6);}
/* TIER 2 */
.sec-bar-t2{background:linear-gradient(90deg,rgba(0,204,221,0.12),rgba(0,204,221,0.02));border-top-color:var(--cyan);}
.sec-tag-t2{background:rgba(0,204,221,0.18);color:var(--cyan);}
.sec-bar-t2 .sec-tickers{color:rgba(0,204,221,0.6);}
/* WATCHLIST */
.sec-bar-watch{background:linear-gradient(90deg,rgba(176,136,255,0.14),rgba(176,136,255,0.03));border-top-color:var(--purple);}
.sec-tag-watch{background:rgba(176,136,255,0.2);color:var(--purple);}
.sec-bar-watch .sec-tickers{color:rgba(176,136,255,0.6);}

.sec-tickers{font-size:10px;font-family:'Space Mono',monospace;letter-spacing:0.5px;}
.sec-hint{font-size:9px;color:var(--sub);opacity:.5;margin-left:auto;}
.sec-add-btn{display:flex;align-items:center;justify-content:center;gap:8px;
  padding:10px 28px;font-size:13px;font-family:'Space Mono',monospace;font-weight:700;
  cursor:pointer;border:none;border-left:1px solid var(--border);
  background:transparent;transition:all .2s;white-space:nowrap;min-width:120px;}
.sec-bar-core  .sec-add-btn{color:var(--amber);background:rgba(255,170,0,0.10);}
.sec-bar-core  .sec-add-btn:hover{background:rgba(255,170,0,0.20);color:#ffd040;}
.sec-bar-t1    .sec-add-btn{color:var(--blue); background:rgba(85,153,255,0.10);}
.sec-bar-t1    .sec-add-btn:hover{background:rgba(85,153,255,0.22);color:#88bbff;}
.sec-bar-t2    .sec-add-btn{color:var(--cyan); background:rgba(0,204,221,0.09);}
.sec-bar-t2    .sec-add-btn:hover{background:rgba(0,204,221,0.20);color:#33ddee;}
.sec-bar-watch .sec-add-btn{color:var(--purple);background:rgba(176,136,255,0.10);}
.sec-bar-watch .sec-add-btn:hover{background:rgba(176,136,255,0.22);color:#cc99ff;}
.sec-add-plus{font-size:18px;line-height:1;font-weight:400;}

/* GRIDS */
.hot-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(360px,1fr));gap:14px;
  padding:14px 24px;background:rgba(255,107,53,0.02);border-bottom:1px solid var(--border);}
.main-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:14px;padding:14px 24px;}
.section-group{border-bottom:1px solid var(--border);padding-bottom:4px;margin-bottom:0;}

/* DROP ZONE */
.drop-zone{border:2px dashed rgba(255,107,53,0.3);border-radius:12px;
  display:flex;align-items:center;justify-content:center;min-height:80px;
  font-size:10px;font-family:'Space Mono',monospace;color:rgba(255,107,53,0.4);
  letter-spacing:1px;transition:all .2s;}
.drop-zone.drag-active{border-color:var(--hot);color:var(--hot);background:rgba(255,107,53,0.05);}

/* CARD */
.card{background:var(--bg2);border:1px solid var(--border);border-radius:12px;
  overflow:hidden;transition:transform .12s,border-color .12s;display:flex;flex-direction:column;position:relative;}
.card:hover{transform:translateY(-2px);border-color:#3e3e3e;}
.card.hot-card{border-color:rgba(255,107,53,0.35);}
.card.hot-card:hover{border-color:rgba(255,107,53,0.65);}
.card.dragging{opacity:.4;transform:scale(.98);}
.card.drag-over{border-color:var(--amber)!important;border-style:dashed;}
.drag-handle{position:absolute;top:10px;right:10px;cursor:grab;opacity:0;
  font-size:14px;color:var(--sub);transition:opacity .15s;z-index:5;}
.card:hover .drag-handle{opacity:.5;}
.hot-toggle{position:absolute;top:10px;right:30px;cursor:pointer;opacity:0;
  font-size:11px;font-family:'Space Mono',monospace;background:rgba(255,107,53,0.15);
  color:var(--hot);padding:2px 6px;border-radius:3px;transition:all .15s;z-index:5;
  border:1px solid rgba(255,107,53,0.3);}
.card:hover .hot-toggle{opacity:1;}

/* Card stripes */
.stripe{height:4px;}
.stripe-ACCUMULATE{background:linear-gradient(90deg,var(--amber),#ffcc55);}
.stripe-WATCH_ENTRY{background:linear-gradient(90deg,var(--purple),var(--blue));}
.stripe-MONITOR{background:linear-gradient(90deg,var(--blue),var(--cyan));}
.stripe-EXTENDED{background:linear-gradient(90deg,var(--red),#ff8855);}

/* Card head */
.card-head{padding:14px 16px 10px;}
.ticker-row{display:flex;align-items:baseline;gap:10px;justify-content:space-between;flex-wrap:wrap;}
.ticker-left{display:flex;align-items:baseline;gap:10px;}
.ticker{font-size:26px;font-weight:800;letter-spacing:-1px;line-height:1;}
.price{font-family:'Space Mono',monospace;font-size:18px;font-weight:700;}
.fullname{font-size:11px;color:var(--sub);margin-top:3px;font-style:italic;}
.badge-row{display:flex;align-items:center;gap:7px;margin-top:8px;flex-wrap:wrap;}

/* Signal pill with hover tooltip */
.sig-wrap{position:relative;display:inline-block;}
.sig-pill{font-size:10px;font-weight:700;font-family:'Space Mono',monospace;
  padding:4px 10px;border-radius:5px;white-space:nowrap;cursor:help;
  border-bottom:1px dashed rgba(255,255,255,0.15);}
.sig-ACCUMULATE{background:rgba(255,170,0,0.15);color:var(--amber);}
.sig-WATCH_ENTRY{background:rgba(176,136,255,0.15);color:var(--purple);}
.sig-MONITOR{background:rgba(85,153,255,0.15);color:var(--blue);}
.sig-EXTENDED{background:rgba(255,80,80,0.15);color:var(--red);}

/* Signal tooltip */
.sig-tooltip{display:none;position:absolute;top:calc(100% + 6px);right:0;z-index:200;
  background:#1a1a1a;border:1px solid var(--border);border-radius:8px;
  padding:14px 16px;width:320px;box-shadow:0 8px 24px rgba(0,0,0,0.7);}
.sig-wrap:hover .sig-tooltip{display:block;}
.sig-tt-title{font-size:8px;font-family:'Space Mono',monospace;color:var(--sub);
  letter-spacing:2px;margin-bottom:10px;}
.sig-tt-row{display:flex;gap:8px;margin-bottom:7px;align-items:flex-start;font-size:11px;line-height:1.5;color:#b8b0a4;}
.sig-tt-row.active-sig .sig-tt-label{box-shadow:0 0 0 1px currentColor;}
.sig-tt-row.active-sig .sig-tt-text{color:var(--text);}
.sig-tt-label{font-family:'Space Mono',monospace;font-size:8px;padding:2px 6px;
  border-radius:3px;flex-shrink:0;margin-top:2px;white-space:nowrap;}

.ma-badge{font-size:12px;font-family:'Space Mono',monospace;font-weight:700;}
.hot-badge{font-size:9px;font-family:'Space Mono',monospace;
  background:rgba(255,107,53,0.15);color:var(--hot);padding:2px 7px;border-radius:3px;}
.lim-badge{font-size:9px;font-family:'Space Mono',monospace;
  background:rgba(255,80,80,0.1);color:var(--red);padding:2px 7px;border-radius:3px;}
.tier-badge{font-size:9px;font-family:'Space Mono',monospace;padding:2px 7px;border-radius:3px;margin-left:auto;}

/* Layer 2 */
.divider{height:1px;background:var(--border);}
.l2{padding:10px 16px 10px;}
.layer-title{font-size:8px;font-family:'Space Mono',monospace;letter-spacing:2px;
  margin-bottom:9px;display:flex;align-items:center;gap:6px;}
.layer-title-bar{width:14px;height:2px;border-radius:1px;display:inline-block;flex-shrink:0;}
.bar-row{display:grid;grid-template-columns:26px 1fr 40px 16px;align-items:center;gap:8px;margin-bottom:7px;}
.bar-lbl{font-size:10px;font-family:'Space Mono',monospace;color:var(--sub);}
.bar-lbl.key{color:var(--text);font-weight:600;}
.bar-track{height:8px;background:var(--dim);border-radius:4px;overflow:hidden;position:relative;}
.bar-track::before{content:'';position:absolute;left:25%;top:0;height:100%;width:1px;background:rgba(255,255,255,0.06);}
.bar-track::after{content:'';position:absolute;left:75%;top:0;height:100%;width:1px;background:rgba(255,255,255,0.06);}
.bar-fill{height:100%;border-radius:4px;transition:width .5s ease;}
.bar-val{font-family:'Space Mono',monospace;font-size:11px;font-weight:700;text-align:right;}
.bar-arr{font-size:14px;font-weight:700;text-align:center;line-height:1;}
.arr-legend{font-size:9px;font-family:'Space Mono',monospace;color:var(--sub);margin-top:4px;display:flex;gap:10px;}
.arr-legend span{display:flex;align-items:center;gap:3px;}

/* Layer 3 */
.l3{padding:8px 16px 10px;background:rgba(176,136,255,0.02);border-top:1px solid rgba(176,136,255,0.08);}
.l3-grid{display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-top:6px;}
.l3-cell{background:var(--bg3);border:1px solid var(--border);border-radius:8px;padding:8px 11px;}
.l3-cell.key{border-color:rgba(176,136,255,0.2);}
.l3-cell.key.firing{border-color:var(--purple);box-shadow:0 0 8px rgba(176,136,255,0.18);}
.l3-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;}
.l3-name{font-size:9px;font-family:'Space Mono',monospace;color:var(--sub);}
.l3-name.key-lbl{color:var(--purple);font-weight:700;}
.l3-arr{font-size:14px;font-weight:700;}
.l3-bar{height:5px;background:rgba(255,255,255,0.05);border-radius:3px;overflow:hidden;margin-bottom:5px;}
.l3-fill{height:100%;border-radius:3px;transition:width .5s ease;}
.l3-val{font-family:'Space Mono',monospace;font-size:13px;font-weight:700;}

/* Score */
.score-row{padding:8px 16px 10px;border-top:1px solid rgba(176,136,255,0.08);
  display:flex;align-items:center;justify-content:space-between;}
.dots{display:flex;gap:5px;}
.dot{width:11px;height:11px;border-radius:50%;transition:all .3s;}
.dot.on{background:var(--purple);box-shadow:0 0 6px rgba(176,136,255,0.5);}
.dot.off{background:var(--bg4);border:1px solid var(--border);}
.state-chip{font-size:9px;font-family:'Space Mono',monospace;padding:3px 9px;border-radius:4px;}
.state-wrap{position:relative;display:inline-block;}
.state-wrap:hover .state-tooltip{display:block;}
.state-tooltip{display:none;position:absolute;bottom:calc(100% + 6px);right:0;z-index:200;
  background:#1a1a1a;border:1px solid var(--border);border-radius:8px;
  padding:14px 16px;width:300px;box-shadow:0 8px 24px rgba(0,0,0,0.7);}
.st-title{font-size:8px;font-family:'Space Mono',monospace;color:var(--sub);letter-spacing:2px;margin-bottom:10px;}
.st-row{display:flex;gap:8px;margin-bottom:7px;align-items:flex-start;font-size:11px;line-height:1.5;color:#b8b0a4;}
.st-row.active-state .st-key{box-shadow:0 0 0 1px currentColor;}
.st-row.active-state .st-desc{color:var(--text);}
.st-key{font-family:'Space Mono',monospace;font-size:8px;padding:2px 6px;border-radius:3px;
  flex-shrink:0;margin-top:2px;white-space:nowrap;}
.state-ENTRY_NOW{background:rgba(0,221,136,0.12);color:var(--green);}
.state-NEAR{background:rgba(176,136,255,0.12);color:var(--purple);}
.state-AT_FLOOR{background:rgba(255,170,0,0.12);color:var(--amber);}
.state-TURNING{background:rgba(85,153,255,0.12);color:var(--blue);}
.state-WAIT{background:var(--bg4);color:var(--sub);}

/* Alert */
.alert-row{padding:9px 16px 12px;border-top:1px solid rgba(255,255,255,0.04);
  font-size:11px;color:#b0a898;line-height:1.6;background:rgba(0,0,0,0.12);}

/* Fill/color utils */
.fill-low{background:var(--green);}
.fill-mid{background:var(--amber);}
.fill-high{background:var(--red);}
.col-low{color:var(--green);}
.col-mid{color:var(--amber);}
.col-high{color:var(--red);}
.up{color:var(--green);}
.dn{color:var(--red);}

/* ADD CARD MODAL */
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.82);z-index:300;
  align-items:center;justify-content:center;}
.modal-overlay.open{display:flex;}
.modal{background:#1e1e1e;border:1px solid #3a3a3a;border-radius:14px;
  padding:24px;width:480px;max-width:94vw;max-height:90vh;overflow-y:auto;}
.modal h3{font-size:17px;font-weight:800;margin-bottom:6px;margin-top:4px;}
.modal p{font-size:11px;color:var(--sub);margin-bottom:18px;line-height:1.6;}
.modal-step-label{font-size:8px;font-family:'Space Mono',monospace;letter-spacing:2px;
  margin-bottom:10px;padding:3px 8px;border-radius:3px;display:inline-block;margin-bottom:12px;}
.modal-field{margin-bottom:14px;}
.modal-field label{display:block;font-size:9px;font-family:'Space Mono',monospace;
  color:var(--sub);letter-spacing:1px;margin-bottom:6px;}
.modal-field input{width:100%;background:var(--bg3);border:1px solid var(--border);
  border-radius:6px;padding:9px 12px;color:var(--text);font-size:13px;font-family:'Space Mono',monospace;
  outline:none;transition:border-color .15s;}
.modal-field input:focus{border-color:var(--amber);}
.modal-link-box{background:var(--bg3);border:1px solid var(--border);border-radius:8px;
  padding:14px 16px;margin-bottom:14px;}
.modal-link{display:block;font-family:'Space Mono',monospace;font-size:11px;
  color:var(--amber);word-break:break-all;margin-top:2px;text-decoration:none;}
.modal-link:hover{text-decoration:underline;}
.modal-link-small{font-family:'Space Mono',monospace;font-size:10px;color:var(--blue);text-decoration:none;}
.modal-link-small:hover{text-decoration:underline;}
.modal-instruction{background:rgba(255,255,255,0.03);border:1px solid var(--border);
  border-radius:8px;padding:14px 16px;font-size:11px;color:#b8b0a4;line-height:2;}
.modal-upload-zone{background:var(--bg3);border:2px dashed var(--border);border-radius:10px;
  padding:32px;text-align:center;cursor:pointer;transition:all .15s;margin-bottom:12px;}
.modal-upload-zone:hover{border-color:var(--amber);background:rgba(255,170,0,0.04);}
.modal-row{display:flex;gap:8px;flex-wrap:wrap;}
.modal-btn{flex:1;padding:10px;border-radius:7px;border:none;cursor:pointer;
  font-family:'Space Mono',monospace;font-size:11px;font-weight:700;transition:all .15s;min-width:80px;}
.modal-btn.primary{background:var(--amber);color:#000;}
.modal-btn.primary:hover{background:#ffbb22;}
.modal-btn.primary:disabled{opacity:.35;cursor:not-allowed;}
.modal-btn.secondary{background:var(--bg4);color:var(--sub);border:1px solid var(--border);}
.modal-btn.secondary:hover{border-color:var(--sub);color:var(--text);}
.modal-btn.cancel{background:var(--bg3);color:var(--sub);border:1px solid var(--border);}
.modal-btn.cancel:hover{border-color:var(--sub);}
.csv-ok{background:rgba(0,221,136,0.08);border:1px solid rgba(0,221,136,0.25);
  border-radius:8px;padding:14px 16px;font-family:'Space Mono',monospace;font-size:11px;line-height:1.9;}
.csv-err{background:rgba(255,80,80,0.08);border:1px solid rgba(255,80,80,0.25);
  border-radius:8px;padding:14px 16px;font-family:'Space Mono',monospace;font-size:11px;line-height:1.9;color:var(--red);}
.modal-asset-list{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:16px;}
.modal-asset-chip{padding:6px 12px;border-radius:6px;border:1px solid var(--border);
  cursor:pointer;font-family:'Space Mono',monospace;font-size:11px;color:var(--sub);transition:all .15s;}
.modal-asset-chip:hover,.modal-asset-chip.sel{background:rgba(255,170,0,0.12);border-color:var(--amber);color:var(--amber);}
.modal-asset-chip.already{opacity:.3;cursor:not-allowed;}
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.75);z-index:200;
  align-items:center;justify-content:center;}
.modal-overlay.open{display:flex;}
.modal{background:var(--bg2);border:1px solid var(--border);border-radius:14px;
  padding:24px;width:420px;max-width:90vw;}
.modal h3{font-size:16px;font-weight:800;margin-bottom:6px;}
.modal p{font-size:11px;color:var(--sub);margin-bottom:18px;line-height:1.5;}
.modal-asset-list{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:16px;}
.modal-asset-chip{padding:6px 12px;border-radius:6px;border:1px solid var(--border);
  cursor:pointer;font-family:'Space Mono',monospace;font-size:11px;color:var(--sub);transition:all .15s;}
.modal-asset-chip:hover,.modal-asset-chip.sel{background:rgba(255,170,0,0.12);border-color:var(--amber);color:var(--amber);}
.modal-asset-chip.already{opacity:.3;cursor:not-allowed;}
.modal-row{display:flex;gap:8px;margin-top:4px;}
.modal-btn{flex:1;padding:10px;border-radius:7px;border:none;cursor:pointer;
  font-family:'Space Mono',monospace;font-size:11px;font-weight:700;transition:all .15s;}
.modal-btn.primary{background:var(--amber);color:#000;}
.modal-btn.primary:hover{background:#ffbb22;}
.modal-btn.cancel{background:var(--bg3);color:var(--sub);border:1px solid var(--border);}

footer{padding:12px 24px;border-top:1px solid var(--border);
  font-size:10px;font-family:'Space Mono',monospace;color:var(--sub);
  display:flex;justify-content:space-between;flex-wrap:wrap;gap:8px;background:var(--bg2);}
</style>
</head>
<body>

<!-- ADD CARD MODAL -->
<div class="modal-overlay" id="modal-overlay">
  <div class="modal" id="modal-box">

    <!-- STEP 1: Asset Details -->
    <div id="step1">
      <div class="modal-step-label" id="modal-step-label">ADDING TO CORE</div>
      <h3>Step 1 ‚Äî Asset Details</h3>
      <p>Enter the ticker and name. We'll auto-generate the CoinGecko slug ‚Äî correct it if needed.</p>
      <div class="modal-field">
        <label>Ticker Symbol</label>
        <input type="text" id="inp-ticker" placeholder="e.g. PENDLE" oninput="autoSlug()" maxlength="12"
          style="text-transform:uppercase">
      </div>
      <div class="modal-field">
        <label>Full Name</label>
        <input type="text" id="inp-name" placeholder="e.g. Pendle Finance" maxlength="40">
      </div>
      <div class="modal-field">
        <label>CoinGecko Slug <span style="color:var(--sub);font-weight:400">(auto-generated ‚Äî edit if wrong)</span></label>
        <input type="text" id="inp-slug" placeholder="e.g. pendle" oninput="updateLinks()" maxlength="60">
      </div>
      <div class="modal-row" style="margin-top:16px">
        <button class="modal-btn cancel" onclick="closeModal()">Cancel</button>
        <button class="modal-btn primary" onclick="goStep2()">Next ‚Üí</button>
      </div>
    </div>

    <!-- STEP 2: CSV Download -->
    <div id="step2" style="display:none">
      <div class="modal-step-label" id="modal-step-label2">ADDING TO CORE</div>
      <h3>Step 2 ‚Äî Download Historical Data</h3>
      <p>Download the Max historical CSV from CoinGecko before continuing. This gives the DPO indicators their full accuracy.</p>
      <div class="modal-link-box">
        <div style="font-size:9px;font-family:'Space Mono',monospace;color:var(--sub);margin-bottom:8px;letter-spacing:1px;">DIRECT LINK (best guess)</div>
        <a id="link-direct" href="#" target="_blank" class="modal-link"></a>
        <div style="font-size:10px;color:var(--sub);margin-top:6px;line-height:1.5">
          If that 404s, use the search fallback:<br>
          <a id="link-search" href="#" target="_blank" class="modal-link-small"></a>
        </div>
      </div>
      <div class="modal-instruction">
        1. Click the link above<br>
        2. Scroll to the historical data table<br>
        3. Select <strong style="color:var(--text)">MAX</strong> date range<br>
        4. Click <strong style="color:var(--text)">Download CSV</strong><br>
        5. Come back and click "I've downloaded it"
      </div>
      <div class="modal-row" style="margin-top:16px">
        <button class="modal-btn cancel" onclick="goStep1()">‚Üê Back</button>
        <button class="modal-btn secondary" onclick="goStep3(true)">Skip ‚Äî add without CSV</button>
        <button class="modal-btn primary" onclick="goStep3(false)">I've downloaded it ‚Üí</button>
      </div>
    </div>

    <!-- STEP 3: CSV Upload & Validate -->
    <div id="step3" style="display:none">
      <div class="modal-step-label" id="modal-step-label3">ADDING TO CORE</div>
      <h3>Step 3 ‚Äî Upload & Validate</h3>
      <p>Select the CSV you just downloaded. We'll check it looks right before adding the card.</p>
      <div class="modal-upload-zone" id="upload-zone" onclick="document.getElementById('csv-input').click()">
        <div style="font-size:24px;margin-bottom:8px">üìÇ</div>
        <div style="font-size:11px;color:var(--sub)">Click to select CSV file</div>
        <input type="file" id="csv-input" accept=".csv" style="display:none" onchange="validateCSV(this)">
      </div>
      <div id="csv-result" style="display:none"></div>
      <div class="modal-row" style="margin-top:16px">
        <button class="modal-btn cancel" onclick="goStep2()">‚Üê Back</button>
        <button class="modal-btn primary" id="btn-add" onclick="finalizeAdd()" disabled>Add Card ‚úì</button>
      </div>
    </div>

  </div>
</div>

<!-- HEADER -->
<header>
  <div class="logo">
    <div class="logo-box">M4</div>
    <div class="logo-text">
      <h1>Dr. Bob's <span>MCAT</span> <span class="vb">v4 LIVE</span></h1>
      <div class="sub">Market Cycle Analysis Tool ¬∑ Three-Layer System</div>
    </div>
  </div>
  <div class="hdr-right">
    <div class="status-pill">
      <div class="status-dot stale" id="status-dot"></div>
      <div class="status-text" id="status-text">Initializing...</div>
    </div>
    <button class="refresh-btn" id="refresh-btn" onclick="refreshAll()">
      <span id="refresh-ico">‚Üª</span> Refresh
    </button>
  </div>
</header>

<!-- DATA WARNING BANNER -->
<div id="data-warning" style="display:none;background:rgba(255,80,80,0.1);border-bottom:2px solid rgba(255,80,80,0.4);
  padding:10px 24px;align-items:center;gap:12px;flex-wrap:wrap;">
  <span style="font-size:16px">‚ö†Ô∏è</span>
  <div style="flex:1;">
    <div style="font-size:11px;font-weight:700;color:var(--red);font-family:'Space Mono',monospace;margin-bottom:2px;">LIVE DATA NOT LOADING</div>
    <div class="dw-msg" style="font-size:11px;color:#c09090;line-height:1.5;">
      Live data is not loading ‚Äî all values shown are seed data from Feb 21, 2026.
      <strong style="color:var(--text)">Do not make trading decisions based on these numbers.</strong>
      A free CoinGecko API key is required. Open the HTML file, find <code style="color:var(--amber)">YOUR_API_KEY_HERE</code> and replace it with your key, then re-upload to GitHub.
    </div>
  </div>
  <button onclick="document.getElementById('data-warning').style.display='none';refreshAll();"
    style="background:var(--red);border:none;border-radius:6px;padding:7px 14px;
    color:#fff;font-family:'Space Mono',monospace;font-size:10px;font-weight:700;cursor:pointer;flex-shrink:0;">
    RETRY
  </button>
  <button onclick="document.getElementById('data-warning').style.display='none';"
    style="background:var(--bg3);border:1px solid var(--border);border-radius:6px;padding:7px 14px;
    color:var(--sub);font-family:'Space Mono',monospace;font-size:10px;cursor:pointer;flex-shrink:0;">
    Dismiss
  </button>
</div>

<!-- SYSTEM GUIDE -->
<div class="guide-wrap">
  <div class="guide-bar">
    <div class="guide-label">? SYSTEM GUIDE</div>
    <div class="guide-hint">hover to expand ‚Üì</div>
    <div class="guide-panel">
      <div class="guide-grid">
        <div class="guide-section">
          <h4 style="color:var(--amber)">LAYER 1 ¬∑ TOTAL3 MASTER GATE</h4>
          <div class="guide-row"><span class="gk" style="background:rgba(0,221,136,0.12);color:var(--green)">AT FLOOR</span><span>Both 1W and 2W below ~25 simultaneously ‚Äî universal altcoin accumulation window is open. Historical: July 2024 floor ‚Üí +100% altcoin market cap.</span></div>
          <div class="guide-row"><span class="gk" style="background:rgba(255,170,0,0.12);color:var(--amber)">LOW RANGE</span><span>Indicators between ~25‚Äì45. Gate open but not at peak opportunity. Accumulation still appropriate with caution.</span></div>
          <div class="guide-row"><span class="gk" style="background:rgba(85,153,255,0.12);color:var(--blue)">MID RANGE</span><span>Indicators between ~45‚Äì65. Market is mid-cycle. Hold existing positions.</span></div>
          <div class="guide-row"><span class="gk" style="background:rgba(255,80,80,0.12);color:var(--red)">HIGH / PEAK</span><span>Both 1W and 2W above ~70 approaching 83‚Äì90 historical peaks ‚Äî begin taking profits. Both peaking simultaneously ‚Üí EXIT / CONSIDER SHORT.</span></div>
        </div>
        <div class="guide-section">
          <h4 style="color:var(--blue)">LAYER 2 ¬∑ INDIVIDUAL ASSET DIRECTION</h4>
          <div class="guide-row"><span class="gk" style="background:rgba(85,153,255,0.12);color:var(--blue)">1W + 2W</span><span>Primary indicators. When both below 25 and turning ‚Üë, asset is in its accumulation zone. 2W bottoms first, then 1W follows.</span></div>
          <div class="guide-row"><span class="gk" style="background:rgba(85,153,255,0.12);color:var(--blue)">1D + 3D</span><span>Fast cycle indicators. When looking to enter, you want these <strong style="color:var(--text)">already rising from a low point</strong>. HK's sequence: 2W bottoms first ‚Üí 1W follows ‚Üí 3D turns up ‚Üí 1D turns last. When the 1D turns ‚Üë from a low level, that is the precise entry moment alongside the 4H Layer 3 trigger firing.</span></div>
          <div class="guide-row"><span class="gk" style="background:rgba(85,153,255,0.12);color:var(--blue)">200MA %</span><span>Price discount vs 200-day moving average. Deeper negative = more upside potential when cycle turns.</span></div>
          <div class="guide-row"><span class="gk" style="background:rgba(255,255,255,0.06);color:var(--sub)">ARROWS ‚Üë‚Üì</span><span>‚Üë green = indicator higher than 5 days ago. ‚Üì red = lower. Watch 1W and 2W arrows for floor confirmation.</span></div>
        </div>
        <div class="guide-section">
          <h4 style="color:var(--purple)">LAYER 3 ¬∑ ENTRY PRECISION</h4>
          <div class="guide-row"><span class="gk" style="background:rgba(176,136,255,0.2);color:var(--purple)">4H TRIGGER ‚òÖ</span><span>HK's most important indicator. When 4H proxy drops below 30 AND turns ‚Üë ‚Äî that is your entry trigger.</span></div>
          <div class="guide-row"><span class="gk" style="background:rgba(176,136,255,0.12);color:var(--purple)">2H + 4H BOTH</span><span>Both bottoming simultaneously = highest conviction entry. This is the precise moment HK pulls the trigger.</span></div>
          <div class="guide-row"><span class="gk" style="background:rgba(0,221,136,0.12);color:var(--green)">SCORE 4/4</span><span>All four sub-daily proxies below 30 and turning ‚Üë simultaneously = ENTRY NOW.</span></div>
        </div>
        <div class="guide-section">
          <h4 style="color:var(--hot)">PORTFOLIO TIERS</h4>
          <div class="guide-row"><span class="gk" style="background:rgba(255,170,0,0.15);color:var(--amber)">CORE</span><span>Highest conviction holdings: XRP, QNT, TAO, CC. Signals are actionable ‚Äî these are your primary buy targets.</span></div>
          <div class="guide-row"><span class="gk" style="background:rgba(85,153,255,0.12);color:var(--blue)">TIER 1</span><span>Strong secondary positions: XLM, HBAR, XDC, ALGO, IOTA, AERO. Signals fire on same criteria ‚Äî apply your own judgment on sizing.</span></div>
          <div class="guide-row"><span class="gk" style="background:rgba(0,204,221,0.10);color:var(--cyan)">TIER 2</span><span>Speculative / limited history: FLR, ZORA. ‚ö† Limited data means less reliable DPO readings. Use signals as directional guides only.</span></div>
          <div class="guide-row"><span class="gk" style="background:rgba(122,112,96,0.15);color:var(--sub)">REFERENCE</span><span>BTC and ETH ‚Äî macro context only. Not current buy targets but useful for reading overall market cycle direction.</span></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- GATE -->
<div class="gate" id="gate-panel">
  <div class="gate-top">
    <div class="gate-led closed" id="gate-led"></div>
    <div class="gate-eyebrow">LAYER 1 ¬∑ TOTAL3 MASTER GATE</div>
    <div class="gate-status-wrap">
      <div class="gate-status" id="gate-status-text" style="color:var(--amber)">Loading...</div>
      <div class="gate-tooltip" id="gate-tooltip">
        <div style="font-size:9px;font-family:'Space Mono',monospace;color:var(--sub);letter-spacing:2px;margin-bottom:10px;">GATE STATUS GUIDE</div>
        <div class="gt-row"><span class="gt-key" style="background:rgba(0,221,136,0.12);color:var(--green)">ACCUMULATE</span><span>Both 1W + 2W below 25 ‚Äî universal altcoin buy window open.</span></div>
        <div class="gt-row"><span class="gt-key" style="background:rgba(255,170,0,0.12);color:var(--amber)">MONITORING</span><span>Indicators mid-range. Gate not yet at floor ‚Äî watching for both to drop below 25.</span></div>
        <div class="gt-row"><span class="gt-key" style="background:rgba(255,80,80,0.12);color:var(--red)">WAIT / SHORT</span><span>One or both indicators above 70 ‚Äî early warning zone. Exit longs, consider shorts. <strong style="color:var(--text)">Higher reliability when both approach 83‚Äì90</strong> (historical peak zone). Current readings shown in boxes to the right.</span></div>
      </div>
    </div>
    <div style="margin-left:auto;font-size:9px;font-family:'Space Mono',monospace;color:var(--sub)" id="gate-updated">seed data</div>
  </div>
  <div class="gate-body">
    <div class="gate-desc" id="gate-desc">Computing TOTAL3 cycle indicators...</div>
    <div class="gate-readings">
      <div class="reading">
        <div class="reading-label">1W CYCLE</div>
        <div class="reading-val" id="gate-1w" style="color:var(--amber)">--</div>
        <div class="reading-trend" id="gate-1w-trend">--</div>
        <div class="reading-sub rsub-mid" id="gate-1w-sub">--</div>
      </div>
      <div class="reading">
        <div class="reading-label">2W CYCLE</div>
        <div class="reading-val" id="gate-2w" style="color:var(--amber)">--</div>
        <div class="reading-trend" id="gate-2w-trend">--</div>
        <div class="reading-sub rsub-mid" id="gate-2w-sub">--</div>
      </div>
      <div class="reading">
        <div class="reading-label">TOTAL3 ~</div>
        <div class="reading-val" id="gate-t3" style="color:var(--blue);font-size:17px;padding-top:4px">--</div>
        <div style="height:22px"></div>
        <div class="reading-sub rsub-mid">excl. BTC+ETH</div>
      </div>
    </div>
  </div>
</div>

<!-- HOT CARDS -->
<div class="sec-bar sec-bar-hot">
  <div class="sec-bar-inner">
    <span class="sec-tag sec-tag-hot">üî• HOT</span>
    <span class="sec-tickers" id="hot-tickers">ACTIVE WATCH</span>
    <span class="sec-hint">drag to reorder</span>
  </div>
</div>
<div class="hot-grid" id="hot-grid"></div>

<!-- REFERENCE -->
<div class="sec-bar sec-bar-ref">
  <div class="sec-bar-inner">
    <span class="sec-tag sec-tag-ref">REFERENCE</span>
    <span class="sec-tickers" id="ref-tickers">BTC ¬∑ ETH</span>
    <span style="font-size:9px;font-family:'Space Mono',monospace;color:var(--sub);opacity:.5;">MACRO CONTEXT ONLY</span>
  </div>
</div>
<div class="main-grid" id="ref-grid"></div>

<!-- CORE -->
<div class="sec-bar sec-bar-core">
  <div class="sec-bar-inner">
    <span class="sec-tag sec-tag-core">CORE</span>
    <span class="sec-tickers" id="core-tickers">XRP ¬∑ QNT ¬∑ TAO ¬∑ CC</span>
  </div>
  <button class="sec-add-btn" onclick="openAddModal('CORE')">
    <span class="sec-add-plus">Ôºã</span> ADD
  </button>
</div>
<div class="main-grid" id="core-grid"></div>

<!-- TIER 1 -->
<div class="sec-bar sec-bar-t1">
  <div class="sec-bar-inner">
    <span class="sec-tag sec-tag-t1">TIER 1</span>
    <span class="sec-tickers" id="t1-tickers">XLM ¬∑ HBAR ¬∑ XDC ¬∑ ALGO ¬∑ IOTA ¬∑ AERO</span>
  </div>
  <button class="sec-add-btn" onclick="openAddModal('TIER1')">
    <span class="sec-add-plus">Ôºã</span> ADD
  </button>
</div>
<div class="main-grid" id="t1-grid"></div>

<!-- TIER 2 -->
<div class="sec-bar sec-bar-t2">
  <div class="sec-bar-inner">
    <span class="sec-tag sec-tag-t2">TIER 2</span>
    <span class="sec-tickers" id="t2-tickers">FLR ¬∑ ZORA</span>
  </div>
  <button class="sec-add-btn" onclick="openAddModal('TIER2')">
    <span class="sec-add-plus">Ôºã</span> ADD
  </button>
</div>
<div class="main-grid" id="t2-grid"></div>

<!-- WATCHLIST -->
<div class="sec-bar sec-bar-watch">
  <div class="sec-bar-inner">
    <span class="sec-tag sec-tag-watch">WATCHLIST</span>
    <span class="sec-tickers" id="watch-tickers">‚Äî empty ‚Äî</span>
  </div>
  <button class="sec-add-btn" onclick="openAddModal('WATCHLIST')">
    <span class="sec-add-plus">Ôºã</span> ADD
  </button>
</div>
<div class="main-grid" id="watch-grid" style="padding-bottom:32px;"></div>

<footer>
  <span>Dr. Bob's MCAT v4 ¬∑ Live ¬∑ CoinGecko API ¬∑ HK-calibrated DPO model</span>
  <span id="footer-time">Last updated: seed data</span>
</footer>

<script>
const ASSET_SEED = {"BTC": {"fullname": "Bitcoin", "tier": "REFERENCE", "hot": false, "price": 67970.294031, "ma200_pct": -31.6, "limited": false, "nrows": 4681, "signal": "ACCUMULATE", "l2": {"1d": {"val": 51.0, "trend": "down"}, "3d": {"val": 45.6, "trend": "up"}, "1w": {"val": 10.8, "trend": "down"}, "2w": {"val": 10.2, "trend": "down"}}, "l3": {"2h": {"val": 51.0, "trend": "down"}, "4h": {"val": 54.0, "trend": "down"}, "8h": {"val": 55.6, "trend": "up"}, "12h": {"val": 47.0, "trend": "up"}}, "score": 0, "l3_state": "WAIT", "alert": "\u26a0\ufe0f Gate open but 1W + 2W both still declining. Watching for floor to confirm."}, "ETH": {"fullname": "Ethereum", "tier": "REFERENCE", "hot": false, "price": 1967.812115, "ma200_pct": -43.9, "limited": false, "nrows": 3851, "signal": "ACCUMULATE", "l2": {"1d": {"val": 60.1, "trend": "up"}, "3d": {"val": 41.3, "trend": "up"}, "1w": {"val": 15.6, "trend": "up"}, "2w": {"val": 18.8, "trend": "down"}}, "l3": {"2h": {"val": 60.1, "trend": "up"}, "4h": {"val": 58.6, "trend": "up"}, "8h": {"val": 55.3, "trend": "up"}, "12h": {"val": 44.0, "trend": "up"}}, "score": 0, "l3_state": "WAIT", "alert": "\u2705 Gate open. 1W: 15.6 \u00b7 2W: 18.8 \u2014 in accumulation zone. Watching for Layer 3 trigger."}, "XRP": {"fullname": "XRP / Ripple", "tier": "CORE", "hot": true, "price": 1.428702, "ma200_pct": -39.2, "limited": false, "nrows": 4580, "signal": "ACCUMULATE", "l2": {"1d": {"val": 47.7, "trend": "down"}, "3d": {"val": 31.8, "trend": "up"}, "1w": {"val": 8.0, "trend": "down"}, "2w": {"val": 9.0, "trend": "down"}}, "l3": {"2h": {"val": 47.7, "trend": "down"}, "4h": {"val": 43.2, "trend": "down"}, "8h": {"val": 43.7, "trend": "up"}, "12h": {"val": 33.4, "trend": "up"}}, "score": 0, "l3_state": "WAIT", "alert": "\u26a0\ufe0f Gate open but 1W + 2W both still declining. Watching for floor to confirm."}, "QNT": {"fullname": "Quant", "tier": "CORE", "hot": false, "price": 67.057574, "ma200_pct": -22.9, "limited": false, "nrows": 2794, "signal": "WATCH_ENTRY", "l2": {"1d": {"val": 37.3, "trend": "down"}, "3d": {"val": 26.6, "trend": "down"}, "1w": {"val": 28.1, "trend": "down"}, "2w": {"val": 28.9, "trend": "down"}}, "l3": {"2h": {"val": 37.3, "trend": "down"}, "4h": {"val": 37.9, "trend": "down"}, "8h": {"val": 31.5, "trend": "down"}, "12h": {"val": 26.7, "trend": "down"}}, "score": 0, "l3_state": "WAIT", "alert": "\ud83d\udc40 Approaching. 1W: 28.1, 2W: 28.9. Need both below 25 for ACCUMULATE."}, "TAO": {"fullname": "Bittensor", "tier": "CORE", "hot": false, "price": 180.959607, "ma200_pct": -40.7, "limited": false, "nrows": 1087, "signal": "WATCH_ENTRY", "l2": {"1d": {"val": 34.9, "trend": "down"}, "3d": {"val": 40.7, "trend": "up"}, "1w": {"val": 26.0, "trend": "down"}, "2w": {"val": 26.7, "trend": "up"}}, "l3": {"2h": {"val": 34.9, "trend": "down"}, "4h": {"val": 39.7, "trend": "down"}, "8h": {"val": 46.7, "trend": "up"}, "12h": {"val": 42.0, "trend": "up"}}, "score": 0, "l3_state": "WAIT", "alert": "\ud83d\udc40 Approaching. 1W: 26.0, 2W: 26.7. Need both below 25 for ACCUMULATE."}, "CC": {"fullname": "Canton Network", "tier": "CORE", "hot": false, "price": 0.158438, "ma200_pct": null, "limited": true, "nrows": 104, "signal": "MONITOR", "l2": {"1d": {"val": 37.8, "trend": "up"}, "3d": {"val": 18.3, "trend": "down"}, "1w": {"val": 0.0, "trend": "down"}, "2w": {"val": 50.0, "trend": "down"}}, "l3": {"2h": {"val": 37.8, "trend": "up"}, "4h": {"val": 37.6, "trend": "up"}, "8h": {"val": 17.9, "trend": "up"}, "12h": {"val": 18.1, "trend": "down"}}, "score": 1, "l3_state": "WAIT", "alert": "\u23f3 2W below 35 (now 50.0). Monitoring for cycle to develop."}, "XLM": {"fullname": "Stellar", "tier": "TIER1", "hot": false, "price": 0.162539, "ma200_pct": -44.0, "limited": false, "nrows": 4212, "signal": "ACCUMULATE", "l2": {"1d": {"val": 29.6, "trend": "down"}, "3d": {"val": 27.1, "trend": "up"}, "1w": {"val": 21.3, "trend": "down"}, "2w": {"val": 21.2, "trend": "down"}}, "l3": {"2h": {"val": 29.6, "trend": "down"}, "4h": {"val": 30.0, "trend": "down"}, "8h": {"val": 31.6, "trend": "down"}, "12h": {"val": 27.9, "trend": "up"}}, "score": 1, "l3_state": "AT_FLOOR", "alert": "\u23f3 Gate open. Waiting for 4H proxy (30) to drop below 30 and turn \u2191."}, "HBAR": {"fullname": "Hedera", "tier": "TIER1", "hot": false, "price": 0.099779, "ma200_pct": -40.1, "limited": false, "nrows": 2349, "signal": "WATCH_ENTRY", "l2": {"1d": {"val": 47.3, "trend": "down"}, "3d": {"val": 33.3, "trend": "up"}, "1w": {"val": 31.6, "trend": "up"}, "2w": {"val": 27.0, "trend": "up"}}, "l3": {"2h": {"val": 47.3, "trend": "down"}, "4h": {"val": 40.4, "trend": "down"}, "8h": {"val": 33.8, "trend": "down"}, "12h": {"val": 33.4, "trend": "up"}}, "score": 0, "l3_state": "WAIT", "alert": "\ud83d\udc40 Approaching. 1W: 31.6, 2W: 27.0. Need both below 25 for ACCUMULATE."}, "XDC": {"fullname": "XDC Network", "tier": "TIER1", "hot": false, "price": 0.035103, "ma200_pct": -40.7, "limited": false, "nrows": 2870, "signal": "ACCUMULATE", "l2": {"1d": {"val": 34.3, "trend": "down"}, "3d": {"val": 30.6, "trend": "down"}, "1w": {"val": 21.0, "trend": "down"}, "2w": {"val": 20.4, "trend": "down"}}, "l3": {"2h": {"val": 34.3, "trend": "down"}, "4h": {"val": 34.5, "trend": "down"}, "8h": {"val": 31.1, "trend": "down"}, "12h": {"val": 30.6, "trend": "down"}}, "score": 0, "l3_state": "AT_FLOOR", "alert": "\u23f3 Gate open. Waiting for 4H proxy (34) to drop below 30 and turn \u2191."}, "ALGO": {"fullname": "Algorand", "tier": "TIER1", "hot": false, "price": 0.090461, "ma200_pct": -47.1, "limited": false, "nrows": 2438, "signal": "WATCH_ENTRY", "l2": {"1d": {"val": 36.8, "trend": "down"}, "3d": {"val": 34.8, "trend": "up"}, "1w": {"val": 29.4, "trend": "down"}, "2w": {"val": 33.1, "trend": "down"}}, "l3": {"2h": {"val": 36.8, "trend": "down"}, "4h": {"val": 30.9, "trend": "down"}, "8h": {"val": 36.3, "trend": "down"}, "12h": {"val": 36.6, "trend": "up"}}, "score": 0, "l3_state": "WAIT", "alert": "\ud83d\udc40 Approaching. 1W: 29.4, 2W: 33.1. Need both below 25 for ACCUMULATE."}, "IOTA": {"fullname": "IOTA", "tier": "TIER1", "hot": false, "price": 0.070404, "ma200_pct": -47.3, "limited": false, "nrows": 3175, "signal": "MONITOR", "l2": {"1d": {"val": 27.8, "trend": "down"}, "3d": {"val": 27.1, "trend": "up"}, "1w": {"val": 35.6, "trend": "up"}, "2w": {"val": 29.8, "trend": "up"}}, "l3": {"2h": {"val": 27.8, "trend": "down"}, "4h": {"val": 27.2, "trend": "up"}, "8h": {"val": 26.8, "trend": "up"}, "12h": {"val": 27.3, "trend": "up"}}, "score": 3, "l3_state": "ENTRY_NOW", "alert": "\u23f3 1W below 35 (now 35.6). Monitoring for cycle to develop."}, "AERO": {"fullname": "Aerodrome", "tier": "TIER1", "hot": false, "price": 0.312844, "ma200_pct": -61.4, "limited": false, "nrows": 890, "signal": "WATCH_ENTRY", "l2": {"1d": {"val": 35.5, "trend": "down"}, "3d": {"val": 38.6, "trend": "up"}, "1w": {"val": 25.2, "trend": "up"}, "2w": {"val": 23.8, "trend": "up"}}, "l3": {"2h": {"val": 35.5, "trend": "down"}, "4h": {"val": 36.6, "trend": "up"}, "8h": {"val": 39.3, "trend": "up"}, "12h": {"val": 39.0, "trend": "up"}}, "score": 0, "l3_state": "WAIT", "alert": "\ud83d\udc40 Approaching. 1W: 25.2, 2W: 23.8. Need both below 25 for ACCUMULATE."}, "FLR": {"fullname": "Flare Network", "tier": "TIER2", "hot": false, "price": 0.009529, "ma200_pct": -41.5, "limited": false, "nrows": 1140, "signal": "WATCH_ENTRY", "l2": {"1d": {"val": 32.0, "trend": "down"}, "3d": {"val": 38.0, "trend": "up"}, "1w": {"val": 30.0, "trend": "down"}, "2w": {"val": 29.8, "trend": "down"}}, "l3": {"2h": {"val": 32.0, "trend": "down"}, "4h": {"val": 30.9, "trend": "down"}, "8h": {"val": 33.7, "trend": "down"}, "12h": {"val": 36.9, "trend": "up"}}, "score": 0, "l3_state": "WAIT", "alert": "\ud83d\udc40 Approaching. 1W: 30.0, 2W: 29.8. Need both below 25 for ACCUMULATE."}, "ZORA": {"fullname": "Zora", "tier": "TIER2", "hot": false, "price": 0.020511, "ma200_pct": -64.8, "limited": true, "nrows": 306, "signal": "ACCUMULATE", "l2": {"1d": {"val": 37.2, "trend": "down"}, "3d": {"val": 27.8, "trend": "up"}, "1w": {"val": 15.2, "trend": "up"}, "2w": {"val": 7.0, "trend": "up"}}, "l3": {"2h": {"val": 37.2, "trend": "down"}, "4h": {"val": 30.4, "trend": "down"}, "8h": {"val": 29.5, "trend": "up"}, "12h": {"val": 27.8, "trend": "up"}}, "score": 2, "l3_state": "NEAR", "alert": "\u2705 Gate open. 1W: 15.2 \u00b7 2W: 7.0 \u2014 in accumulation zone. Watching for Layer 3 trigger."}};
const TOTAL3_SEED = [{"date_str": "2025-04-28", "total3": 966671523597.0, "dpo1w": 40.71, "dpo2w": 32.79}, {"date_str": "2025-04-29", "total3": 974346559890.0, "dpo1w": 41.87, "dpo2w": 33.97}, {"date_str": "2025-04-30", "total3": 968372161675.0, "dpo1w": 41.63, "dpo2w": 33.84}, {"date_str": "2025-05-01", "total3": 962910443330.0, "dpo1w": 41.26, "dpo2w": 33.79}, {"date_str": "2025-05-02", "total3": 977136042978.0, "dpo1w": 43.02, "dpo2w": 35.65}, {"date_str": "2025-05-03", "total3": 976537441063.0, "dpo1w": 43.5, "dpo2w": 36.08}, {"date_str": "2025-05-04", "total3": 960961426588.0, "dpo1w": 42.01, "dpo2w": 35.05}, {"date_str": "2025-05-05", "total3": 948033799203.0, "dpo1w": 40.9, "dpo2w": 34.14}, {"date_str": "2025-05-06", "total3": 949683305925.0, "dpo1w": 41.35, "dpo2w": 34.64}, {"date_str": "2025-05-07", "total3": 949922123877.0, "dpo1w": 41.7, "dpo2w": 34.92}, {"date_str": "2025-05-08", "total3": 950524356519.0, "dpo1w": 42.01, "dpo2w": 35.33}, {"date_str": "2025-05-09", "total3": 1029085214858.0, "dpo1w": 50.33, "dpo2w": 43.06}, {"date_str": "2025-05-10", "total3": 1054629013491.0, "dpo1w": 53.0, "dpo2w": 45.81}, {"date_str": "2025-05-11", "total3": 1105308118086.0, "dpo1w": 58.14, "dpo2w": 50.86}, {"date_str": "2025-05-12", "total3": 1082271026591.0, "dpo1w": 55.76, "dpo2w": 48.98}, {"date_str": "2025-05-13", "total3": 1090939856519.0, "dpo1w": 56.67, "dpo2w": 50.08}, {"date_str": "2025-05-14", "total3": 1118233393452.0, "dpo1w": 59.39, "dpo2w": 52.89}, {"date_str": "2025-05-15", "total3": 1090724755668.0, "dpo1w": 56.47, "dpo2w": 50.61}, {"date_str": "2025-05-16", "total3": 1059630569780.0, "dpo1w": 53.22, "dpo2w": 47.98}, {"date_str": "2025-05-17", "total3": 1053663350940.0, "dpo1w": 52.49, "dpo2w": 47.78}, {"date_str": "2025-05-18", "total3": 1038041839028.0, "dpo1w": 50.8, "dpo2w": 46.66}, {"date_str": "2025-05-19", "total3": 1078057903002.0, "dpo1w": 54.85, "dpo2w": 50.77}, {"date_str": "2025-05-20", "total3": 1050600567017.0, "dpo1w": 52.02, "dpo2w": 48.48}, {"date_str": "2025-05-21", "total3": 1054921045954.0, "dpo1w": 52.42, "dpo2w": 49.12}, {"date_str": "2025-05-22", "total3": 1077372296824.0, "dpo1w": 54.71, "dpo2w": 51.51}, {"date_str": "2025-05-23", "total3": 1110419414891.0, "dpo1w": 58.06, "dpo2w": 54.91}, {"date_str": "2025-05-24", "total3": 1061578785711.0, "dpo1w": 52.98, "dpo2w": 50.47}, {"date_str": "2025-05-25", "total3": 1065019386480.0, "dpo1w": 53.4, "dpo2w": 50.97}, {"date_str": "2025-05-26", "total3": 1073567585311.0, "dpo1w": 54.39, "dpo2w": 51.94}, {"date_str": "2025-05-27", "total3": 1068575547892.0, "dpo1w": 53.93, "dpo2w": 51.48}, {"date_str": "2025-05-28", "total3": 1075288791148.0, "dpo1w": 54.7, "dpo2w": 52.12}, {"date_str": "2025-05-29", "total3": 1066292827467.0, "dpo1w": 53.74, "dpo2w": 51.27}, {"date_str": "2025-05-30", "total3": 1047568323640.0, "dpo1w": 51.51, "dpo2w": 49.48}, {"date_str": "2025-05-31", "total3": 1002931932088.0, "dpo1w": 46.52, "dpo2w": 45.24}, {"date_str": "2025-06-01", "total3": 1007879825277.0, "dpo1w": 46.53, "dpo2w": 45.71}, {"date_str": "2025-06-02", "total3": 1014273991407.0, "dpo1w": 46.77, "dpo2w": 46.5}, {"date_str": "2025-06-03", "total3": 1022351910054.0, "dpo1w": 47.08, "dpo2w": 47.23}, {"date_str": "2025-06-04", "total3": 1024066675182.0, "dpo1w": 46.66, "dpo2w": 47.42}, {"date_str": "2025-06-05", "total3": 1010945057786.0, "dpo1w": 44.81, "dpo2w": 46.26}, {"date_str": "2025-06-06", "total3": 974094468063.0, "dpo1w": 40.58, "dpo2w": 42.86}, {"date_str": "2025-06-07", "total3": 993338388043.0, "dpo1w": 41.97, "dpo2w": 44.72}, {"date_str": "2025-06-08", "total3": 1008126718922.0, "dpo1w": 42.94, "dpo2w": 46.13}, {"date_str": "2025-06-09", "total3": 1017632111306.0, "dpo1w": 43.24, "dpo2w": 46.82}, {"date_str": "2025-06-10", "total3": 1049342012145.0, "dpo1w": 46.08, "dpo2w": 49.51}, {"date_str": "2025-06-11", "total3": 1069236101874.0, "dpo1w": 47.62, "dpo2w": 51.07}, {"date_str": "2025-06-12", "total3": 1049136714749.0, "dpo1w": 45.04, "dpo2w": 48.89}, {"date_str": "2025-06-13", "total3": 1014310499645.0, "dpo1w": 40.92, "dpo2w": 45.31}, {"date_str": "2025-06-14", "total3": 1006355629610.0, "dpo1w": 39.66, "dpo2w": 44.27}, {"date_str": "2025-06-15", "total3": 992658105434.0, "dpo1w": 37.79, "dpo2w": 42.76}, {"date_str": "2025-06-16", "total3": 1002879371595.0, "dpo1w": 38.34, "dpo2w": 43.51}, {"date_str": "2025-06-17", "total3": 1004890646448.0, "dpo1w": 38.05, "dpo2w": 43.52}, {"date_str": "2025-06-18", "total3": 986402468809.0, "dpo1w": 35.65, "dpo2w": 41.61}, {"date_str": "2025-06-19", "total3": 991768147571.0, "dpo1w": 35.74, "dpo2w": 41.96}, {"date_str": "2025-06-20", "total3": 987062957183.0, "dpo1w": 34.87, "dpo2w": 41.36}, {"date_str": "2025-06-21", "total3": 965758956057.0, "dpo1w": 32.4, "dpo2w": 39.18}, {"date_str": "2025-06-22", "total3": 957612503503.0, "dpo1w": 31.29, "dpo2w": 38.21}, {"date_str": "2025-06-23", "total3": 930445020029.0, "dpo1w": 28.3, "dpo2w": 35.42}, {"date_str": "2025-06-24", "total3": 982065444188.0, "dpo1w": 33.48, "dpo2w": 40.18}, {"date_str": "2025-06-25", "total3": 988989443536.0, "dpo1w": 34.04, "dpo2w": 40.71}, {"date_str": "2025-06-26", "total3": 984017093560.0, "dpo1w": 33.4, "dpo2w": 40.08}, {"date_str": "2025-06-27", "total3": 964726969748.0, "dpo1w": 31.41, "dpo2w": 38.12}, {"date_str": "2025-06-28", "total3": 974816781457.0, "dpo1w": 32.39, "dpo2w": 38.86}, {"date_str": "2025-06-29", "total3": 988245595361.0, "dpo1w": 33.69, "dpo2w": 39.88}, {"date_str": "2025-06-30", "total3": 1003838185726.0, "dpo1w": 35.17, "dpo2w": 41.14}, {"date_str": "2025-07-01", "total3": 999132257409.0, "dpo1w": 34.46, "dpo2w": 40.55}, {"date_str": "2025-07-02", "total3": 976498582037.0, "dpo1w": 31.88, "dpo2w": 38.28}, {"date_str": "2025-07-03", "total3": 1005352452793.0, "dpo1w": 34.68, "dpo2w": 40.8}, {"date_str": "2025-07-04", "total3": 971511996689.0, "dpo1w": 31.04, "dpo2w": 37.39}, {"date_str": "2025-07-05", "total3": 950862805414.0, "dpo1w": 28.76, "dpo2w": 35.25}, {"date_str": "2025-07-06", "total3": 952756435638.0, "dpo1w": 28.84, "dpo2w": 35.25}, {"date_str": "2025-07-07", "total3": 967160153399.0, "dpo1w": 30.19, "dpo2w": 36.37}, {"date_str": "2025-07-08", "total3": 958842433948.0, "dpo1w": 29.19, "dpo2w": 35.32}, {"date_str": "2025-07-09", "total3": 957531572042.0, "dpo1w": 29.17, "dpo2w": 34.89}, {"date_str": "2025-07-10", "total3": 981741714401.0, "dpo1w": 31.83, "dpo2w": 36.95}, {"date_str": "2025-07-11", "total3": 1027857342626.0, "dpo1w": 36.91, "dpo2w": 41.01}, {"date_str": "2025-07-12", "total3": 1044680116272.0, "dpo1w": 38.95, "dpo2w": 42.3}, {"date_str": "2025-07-13", "total3": 1040867030225.0, "dpo1w": 38.9, "dpo2w": 41.72}, {"date_str": "2025-07-14", "total3": 1060822883407.0, "dpo1w": 41.45, "dpo2w": 43.41}, {"date_str": "2025-07-15", "total3": 1071180161113.0, "dpo1w": 42.8, "dpo2w": 44.21}, {"date_str": "2025-07-16", "total3": 1080109126686.0, "dpo1w": 43.91, "dpo2w": 44.87}, {"date_str": "2025-07-17", "total3": 1103573843223.0, "dpo1w": 46.51, "dpo2w": 46.89}, {"date_str": "2025-07-18", "total3": 1144616254558.0, "dpo1w": 50.95, "dpo2w": 50.57}, {"date_str": "2025-07-19", "total3": 1146852155678.0, "dpo1w": 51.45, "dpo2w": 50.63}, {"date_str": "2025-07-20", "total3": 1157450449493.0, "dpo1w": 52.7, "dpo2w": 51.49}, {"date_str": "2025-07-21", "total3": 1182503771954.0, "dpo1w": 55.43, "dpo2w": 53.71}, {"date_str": "2025-07-22", "total3": 1200822113273.0, "dpo1w": 57.52, "dpo2w": 55.34}, {"date_str": "2025-07-23", "total3": 1210551833458.0, "dpo1w": 58.88, "dpo2w": 56.25}, {"date_str": "2025-07-24", "total3": 1146566241566.0, "dpo1w": 52.4, "dpo2w": 50.25}, {"date_str": "2025-07-25", "total3": 1131332908231.0, "dpo1w": 51.07, "dpo2w": 48.78}, {"date_str": "2025-07-26", "total3": 1149256469806.0, "dpo1w": 53.24, "dpo2w": 50.44}, {"date_str": "2025-07-27", "total3": 1154384955221.0, "dpo1w": 54.07, "dpo2w": 50.91}, {"date_str": "2025-07-28", "total3": 1181107399804.0, "dpo1w": 57.11, "dpo2w": 53.43}, {"date_str": "2025-07-29", "total3": 1139568780086.0, "dpo1w": 53.1, "dpo2w": 49.51}, {"date_str": "2025-07-30", "total3": 1139441649379.0, "dpo1w": 53.32, "dpo2w": 49.47}, {"date_str": "2025-07-31", "total3": 1128086499246.0, "dpo1w": 52.2, "dpo2w": 48.33}, {"date_str": "2025-08-01", "total3": 1105190116559.0, "dpo1w": 49.78, "dpo2w": 46.13}, {"date_str": "2025-08-02", "total3": 1080000705292.0, "dpo1w": 47.09, "dpo2w": 43.75}, {"date_str": "2025-08-03", "total3": 1049013631137.0, "dpo1w": 43.84, "dpo2w": 40.76}, {"date_str": "2025-08-04", "total3": 1081569884474.0, "dpo1w": 47.11, "dpo2w": 43.8}, {"date_str": "2025-08-05", "total3": 1108067869211.0, "dpo1w": 49.7, "dpo2w": 46.3}, {"date_str": "2025-08-06", "total3": 1086659694333.0, "dpo1w": 47.21, "dpo2w": 44.27}, {"date_str": "2025-08-07", "total3": 1100646752487.0, "dpo1w": 48.37, "dpo2w": 45.56}, {"date_str": "2025-08-08", "total3": 1151016864114.0, "dpo1w": 53.23, "dpo2w": 50.43}, {"date_str": "2025-08-09", "total3": 1159258459200.0, "dpo1w": 53.74, "dpo2w": 51.36}, {"date_str": "2025-08-10", "total3": 1174363705329.0, "dpo1w": 55.03, "dpo2w": 52.98}, {"date_str": "2025-08-11", "total3": 1174026521353.0, "dpo1w": 54.7, "dpo2w": 53.04}, {"date_str": "2025-08-12", "total3": 1148534846653.0, "dpo1w": 51.67, "dpo2w": 50.7}, {"date_str": "2025-08-13", "total3": 1193244236311.0, "dpo1w": 55.79, "dpo2w": 55.05}, {"date_str": "2025-08-14", "total3": 1222940673072.0, "dpo1w": 58.5, "dpo2w": 57.9}, {"date_str": "2025-08-15", "total3": 1172756412566.0, "dpo1w": 52.95, "dpo2w": 53.14}, {"date_str": "2025-08-16", "total3": 1173300710199.0, "dpo1w": 52.63, "dpo2w": 53.15}, {"date_str": "2025-08-17", "total3": 1181159226016.0, "dpo1w": 53.05, "dpo2w": 53.79}, {"date_str": "2025-08-18", "total3": 1190286694873.0, "dpo1w": 53.49, "dpo2w": 54.55}, {"date_str": "2025-08-19", "total3": 1168876325483.0, "dpo1w": 50.9, "dpo2w": 52.37}, {"date_str": "2025-08-20", "total3": 1128515641289.0, "dpo1w": 46.33, "dpo2w": 48.4}, {"date_str": "2025-08-21", "total3": 1166996077580.0, "dpo1w": 49.89, "dpo2w": 51.87}, {"date_str": "2025-08-22", "total3": 1141073759399.0, "dpo1w": 46.83, "dpo2w": 49.28}, {"date_str": "2025-08-23", "total3": 1214888156126.0, "dpo1w": 54.07, "dpo2w": 56.02}, {"date_str": "2025-08-24", "total3": 1207029206818.0, "dpo1w": 53.09, "dpo2w": 55.15}, {"date_str": "2025-08-25", "total3": 1197967963517.0, "dpo1w": 51.91, "dpo2w": 54.2}, {"date_str": "2025-08-26", "total3": 1133913804823.0, "dpo1w": 44.97, "dpo2w": 48.02}, {"date_str": "2025-08-27", "total3": 1172142563532.0, "dpo1w": 48.6, "dpo2w": 51.51}, {"date_str": "2025-08-28", "total3": 1167358069026.0, "dpo1w": 47.78, "dpo2w": 50.88}, {"date_str": "2025-08-29", "total3": 1194792707451.0, "dpo1w": 50.2, "dpo2w": 53.32}, {"date_str": "2025-08-30", "total3": 1154696174886.0, "dpo1w": 45.65, "dpo2w": 49.32}, {"date_str": "2025-08-31", "total3": 1162063572411.0, "dpo1w": 45.96, "dpo2w": 49.83}, {"date_str": "2025-09-01", "total3": 1152081605376.0, "dpo1w": 44.42, "dpo2w": 48.74}, {"date_str": "2025-09-02", "total3": 1147508741144.0, "dpo1w": 43.57, "dpo2w": 48.22}, {"date_str": "2025-09-03", "total3": 1186782435207.0, "dpo1w": 47.06, "dpo2w": 51.89}, {"date_str": "2025-09-04", "total3": 1190196909621.0, "dpo1w": 46.71, "dpo2w": 52.1}, {"date_str": "2025-09-05", "total3": 1168017740299.0, "dpo1w": 43.85, "dpo2w": 49.79}, {"date_str": "2025-09-06", "total3": 1178667754846.0, "dpo1w": 44.42, "dpo2w": 50.65}, {"date_str": "2025-09-07", "total3": 1175846742002.0, "dpo1w": 43.55, "dpo2w": 50.24}, {"date_str": "2025-09-08", "total3": 1198271756737.0, "dpo1w": 45.27, "dpo2w": 52.15}, {"date_str": "2025-09-09", "total3": 1220520389041.0, "dpo1w": 47.09, "dpo2w": 54.08}, {"date_str": "2025-09-10", "total3": 1221267100088.0, "dpo1w": 46.9, "dpo2w": 53.98}, {"date_str": "2025-09-11", "total3": 1243290161714.0, "dpo1w": 48.86, "dpo2w": 55.86}, {"date_str": "2025-09-12", "total3": 1261551157757.0, "dpo1w": 50.49, "dpo2w": 57.38}, {"date_str": "2025-09-13", "total3": 1287571250684.0, "dpo1w": 52.79, "dpo2w": 59.54}, {"date_str": "2025-09-14", "total3": 1298724802295.0, "dpo1w": 53.59, "dpo2w": 60.23}, {"date_str": "2025-09-15", "total3": 1277751488820.0, "dpo1w": 51.11, "dpo2w": 57.98}, {"date_str": "2025-09-16", "total3": 1261164819433.0, "dpo1w": 49.32, "dpo2w": 56.15}, {"date_str": "2025-09-17", "total3": 1277530662226.0, "dpo1w": 50.94, "dpo2w": 57.39}, {"date_str": "2025-09-18", "total3": 1300337760846.0, "dpo1w": 53.25, "dpo2w": 59.23}, {"date_str": "2025-09-19", "total3": 1311183908719.0, "dpo1w": 54.27, "dpo2w": 59.97}, {"date_str": "2025-09-20", "total3": 1282117659069.0, "dpo1w": 51.34, "dpo2w": 56.97}, {"date_str": "2025-09-21", "total3": 1293016894309.0, "dpo1w": 52.57, "dpo2w": 57.67}, {"date_str": "2025-09-22", "total3": 1283978712923.0, "dpo1w": 51.78, "dpo2w": 56.48}, {"date_str": "2025-09-23", "total3": 1234740736655.0, "dpo1w": 46.69, "dpo2w": 51.47}, {"date_str": "2025-09-24", "total3": 1227721336823.0, "dpo1w": 45.82, "dpo2w": 50.46}, {"date_str": "2025-09-25", "total3": 1237582700755.0, "dpo1w": 46.73, "dpo2w": 51.06}, {"date_str": "2025-09-26", "total3": 1178197514851.0, "dpo1w": 40.56, "dpo2w": 45.18}, {"date_str": "2025-09-27", "total3": 1206952276379.0, "dpo1w": 43.54, "dpo2w": 47.59}, {"date_str": "2025-09-28", "total3": 1205592644136.0, "dpo1w": 43.3, "dpo2w": 47.18}, {"date_str": "2025-09-29", "total3": 1227284396573.0, "dpo1w": 45.39, "dpo2w": 48.93}, {"date_str": "2025-09-30", "total3": 1235903372936.0, "dpo1w": 46.05, "dpo2w": 49.49}, {"date_str": "2025-10-01", "total3": 1221279426262.0, "dpo1w": 44.23, "dpo2w": 47.82}, {"date_str": "2025-10-02", "total3": 1266423286952.0, "dpo1w": 48.48, "dpo2w": 51.85}, {"date_str": "2025-10-03", "total3": 1305357481466.0, "dpo1w": 51.96, "dpo2w": 55.25}, {"date_str": "2025-10-04", "total3": 1316106608827.0, "dpo1w": 52.54, "dpo2w": 55.9}, {"date_str": "2025-10-05", "total3": 1295994951076.0, "dpo1w": 49.96, "dpo2w": 53.62}, {"date_str": "2025-10-06", "total3": 1298114959023.0, "dpo1w": 49.69, "dpo2w": 53.51}, {"date_str": "2025-10-07", "total3": 1326769740257.0, "dpo1w": 52.24, "dpo2w": 55.87}, {"date_str": "2025-10-08", "total3": 1297274835575.0, "dpo1w": 48.86, "dpo2w": 52.74}, {"date_str": "2025-10-09", "total3": 1316569857572.0, "dpo1w": 50.49, "dpo2w": 54.22}, {"date_str": "2025-10-10", "total3": 1290220873383.0, "dpo1w": 47.41, "dpo2w": 51.43}, {"date_str": "2025-10-11", "total3": 1121785310642.0, "dpo1w": 29.71, "dpo2w": 35.24}, {"date_str": "2025-10-12", "total3": 1123047754799.0, "dpo1w": 29.47, "dpo2w": 35.05}, {"date_str": "2025-10-13", "total3": 1207371442422.0, "dpo1w": 37.96, "dpo2w": 42.69}, {"date_str": "2025-10-14", "total3": 1231730737695.0, "dpo1w": 40.44, "dpo2w": 44.65}, {"date_str": "2025-10-15", "total3": 1192957388533.0, "dpo1w": 36.29, "dpo2w": 40.65}, {"date_str": "2025-10-16", "total3": 1165209968046.0, "dpo1w": 33.26, "dpo2w": 37.75}, {"date_str": "2025-10-17", "total3": 1140136434325.0, "dpo1w": 30.67, "dpo2w": 35.2}, {"date_str": "2025-10-18", "total3": 1111591862383.0, "dpo1w": 27.68, "dpo2w": 32.3}, {"date_str": "2025-10-19", "total3": 1131602452899.0, "dpo1w": 29.65, "dpo2w": 33.96}, {"date_str": "2025-10-20", "total3": 1142643155324.0, "dpo1w": 30.54, "dpo2w": 34.8}, {"date_str": "2025-10-21", "total3": 1150803679106.0, "dpo1w": 31.2, "dpo2w": 35.45}, {"date_str": "2025-10-22", "total3": 1126326705213.0, "dpo1w": 28.46, "dpo2w": 33.01}, {"date_str": "2025-10-23", "total3": 1116358062267.0, "dpo1w": 27.3, "dpo2w": 31.85}, {"date_str": "2025-10-24", "total3": 1131130175987.0, "dpo1w": 28.57, "dpo2w": 33.08}, {"date_str": "2025-10-25", "total3": 1139301146944.0, "dpo1w": 29.11, "dpo2w": 33.73}, {"date_str": "2025-10-26", "total3": 1152488173387.0, "dpo1w": 30.06, "dpo2w": 34.84}, {"date_str": "2025-10-27", "total3": 1176201837390.0, "dpo1w": 32.18, "dpo2w": 37.09}, {"date_str": "2025-10-28", "total3": 1166691491904.0, "dpo1w": 30.79, "dpo2w": 36.08}, {"date_str": "2025-10-29", "total3": 1148829923057.0, "dpo1w": 28.68, "dpo2w": 34.29}, {"date_str": "2025-10-30", "total3": 1148211095282.0, "dpo1w": 28.19, "dpo2w": 34.08}, {"date_str": "2025-10-31", "total3": 1103515409242.0, "dpo1w": 23.24, "dpo2w": 29.65}, {"date_str": "2025-11-01", "total3": 1126176852684.0, "dpo1w": 25.66, "dpo2w": 31.57}, {"date_str": "2025-11-02", "total3": 1135506828995.0, "dpo1w": 26.69, "dpo2w": 32.11}, {"date_str": "2025-11-03", "total3": 1140599037109.0, "dpo1w": 27.16, "dpo2w": 32.24}, {"date_str": "2025-11-04", "total3": 1061753414743.0, "dpo1w": 18.9, "dpo2w": 24.46}, {"date_str": "2025-11-05", "total3": 1029460784357.0, "dpo1w": 15.5, "dpo2w": 21.08}, {"date_str": "2025-11-06", "total3": 1063876375027.0, "dpo1w": 19.09, "dpo2w": 24.02}, {"date_str": "2025-11-07", "total3": 1043387819669.0, "dpo1w": 17.06, "dpo2w": 21.81}, {"date_str": "2025-11-08", "total3": 1092412149338.0, "dpo1w": 22.36, "dpo2w": 26.22}, {"date_str": "2025-11-09", "total3": 1082983737541.0, "dpo1w": 21.61, "dpo2w": 25.11}, {"date_str": "2025-11-10", "total3": 1102489268580.0, "dpo1w": 23.83, "dpo2w": 26.77}, {"date_str": "2025-11-11", "total3": 1122299199673.0, "dpo1w": 26.12, "dpo2w": 28.68}, {"date_str": "2025-11-12", "total3": 1082867585439.0, "dpo1w": 22.39, "dpo2w": 25.07}, {"date_str": "2025-11-13", "total3": 1080370536910.0, "dpo1w": 22.58, "dpo2w": 24.86}, {"date_str": "2025-11-14", "total3": 1047219467830.0, "dpo1w": 19.58, "dpo2w": 21.63}, {"date_str": "2025-11-15", "total3": 1021820227020.0, "dpo1w": 17.31, "dpo2w": 19.2}, {"date_str": "2025-11-16", "total3": 1043868437331.0, "dpo1w": 19.88, "dpo2w": 21.31}, {"date_str": "2025-11-17", "total3": 1024580629231.0, "dpo1w": 18.14, "dpo2w": 19.57}, {"date_str": "2025-11-18", "total3": 1011671295180.0, "dpo1w": 17.15, "dpo2w": 18.44}, {"date_str": "2025-11-19", "total3": 1040480806282.0, "dpo1w": 20.55, "dpo2w": 21.16}, {"date_str": "2025-11-20", "total3": 1017220690591.0, "dpo1w": 18.49, "dpo2w": 19.0}, {"date_str": "2025-11-21", "total3": 979090273543.0, "dpo1w": 15.04, "dpo2w": 15.38}, {"date_str": "2025-11-22", "total3": 957979637286.0, "dpo1w": 13.26, "dpo2w": 13.53}, {"date_str": "2025-11-23", "total3": 953667421857.0, "dpo1w": 13.08, "dpo2w": 13.26}, {"date_str": "2025-11-24", "total3": 968963393208.0, "dpo1w": 14.88, "dpo2w": 14.81}, {"date_str": "2025-11-25", "total3": 996966314729.0, "dpo1w": 18.23, "dpo2w": 17.45}, {"date_str": "2025-11-26", "total3": 998604777866.0, "dpo1w": 18.79, "dpo2w": 17.63}, {"date_str": "2025-11-27", "total3": 1013811638632.0, "dpo1w": 20.73, "dpo2w": 19.06}, {"date_str": "2025-11-28", "total3": 1011009782519.0, "dpo1w": 20.86, "dpo2w": 18.84}, {"date_str": "2025-11-29", "total3": 1002213453937.0, "dpo1w": 20.3, "dpo2w": 18.01}, {"date_str": "2025-11-30", "total3": 997717972406.0, "dpo1w": 20.23, "dpo2w": 17.61}, {"date_str": "2025-12-01", "total3": 987727292073.0, "dpo1w": 19.5, "dpo2w": 16.75}, {"date_str": "2025-12-02", "total3": 954556955579.0, "dpo1w": 16.44, "dpo2w": 13.65}, {"date_str": "2025-12-03", "total3": 992847151870.0, "dpo1w": 20.98, "dpo2w": 17.34}, {"date_str": "2025-12-04", "total3": 1015987174493.0, "dpo1w": 23.98, "dpo2w": 19.61}, {"date_str": "2025-12-05", "total3": 997368092804.0, "dpo1w": 22.7, "dpo2w": 18.02}, {"date_str": "2025-12-06", "total3": 980289604351.0, "dpo1w": 21.65, "dpo2w": 16.64}, {"date_str": "2025-12-07", "total3": 981581316762.0, "dpo1w": 22.51, "dpo2w": 16.94}, {"date_str": "2025-12-08", "total3": 984599401825.0, "dpo1w": 23.53, "dpo2w": 17.46}, {"date_str": "2025-12-09", "total3": 991044207127.0, "dpo1w": 24.99, "dpo2w": 18.27}, {"date_str": "2025-12-10", "total3": 1002402068129.0, "dpo1w": 26.81, "dpo2w": 19.56}, {"date_str": "2025-12-11", "total3": 998314884232.0, "dpo1w": 26.65, "dpo2w": 19.4}, {"date_str": "2025-12-12", "total3": 992169471726.0, "dpo1w": 26.39, "dpo2w": 19.04}, {"date_str": "2025-12-13", "total3": 980787076544.0, "dpo1w": 25.86, "dpo2w": 18.29}, {"date_str": "2025-12-14", "total3": 992479508347.0, "dpo1w": 27.79, "dpo2w": 19.73}, {"date_str": "2025-12-15", "total3": 972566877618.0, "dpo1w": 26.31, "dpo2w": 18.22}, {"date_str": "2025-12-16", "total3": 958478357679.0, "dpo1w": 25.28, "dpo2w": 17.26}, {"date_str": "2025-12-17", "total3": 963915689532.0, "dpo1w": 26.21, "dpo2w": 18.14}, {"date_str": "2025-12-18", "total3": 938657148198.0, "dpo1w": 23.85, "dpo2w": 16.19}, {"date_str": "2025-12-19", "total3": 923184128348.0, "dpo1w": 22.56, "dpo2w": 15.2}, {"date_str": "2025-12-20", "total3": 951343857640.0, "dpo1w": 25.84, "dpo2w": 18.24}, {"date_str": "2025-12-21", "total3": 957751190670.0, "dpo1w": 26.9, "dpo2w": 19.28}, {"date_str": "2025-12-22", "total3": 955394735640.0, "dpo1w": 27.01, "dpo2w": 19.54}, {"date_str": "2025-12-23", "total3": 952796625413.0, "dpo1w": 27.16, "dpo2w": 19.73}, {"date_str": "2025-12-24", "total3": 941534928686.0, "dpo1w": 26.35, "dpo2w": 19.1}, {"date_str": "2025-12-25", "total3": 939591899422.0, "dpo1w": 26.47, "dpo2w": 19.34}, {"date_str": "2025-12-26", "total3": 928575058806.0, "dpo1w": 25.73, "dpo2w": 18.58}, {"date_str": "2025-12-27", "total3": 934968962300.0, "dpo1w": 26.9, "dpo2w": 19.51}, {"date_str": "2025-12-28", "total3": 950573280124.0, "dpo1w": 28.99, "dpo2w": 21.29}, {"date_str": "2025-12-29", "total3": 952596602604.0, "dpo1w": 29.63, "dpo2w": 21.82}, {"date_str": "2025-12-30", "total3": 943612532668.0, "dpo1w": 29.11, "dpo2w": 21.34}, {"date_str": "2025-12-31", "total3": 949922988070.0, "dpo1w": 30.02, "dpo2w": 22.29}, {"date_str": "2026-01-01", "total3": 941725005941.0, "dpo1w": 29.5, "dpo2w": 21.95}, {"date_str": "2026-01-02", "total3": 956745712867.0, "dpo1w": 31.43, "dpo2w": 23.92}, {"date_str": "2026-01-03", "total3": 982847201883.0, "dpo1w": 34.54, "dpo2w": 26.9}, {"date_str": "2026-01-04", "total3": 990468437531.0, "dpo1w": 35.51, "dpo2w": 28.06}, {"date_str": "2026-01-05", "total3": 1005136002272.0, "dpo1w": 37.17, "dpo2w": 29.91}, {"date_str": "2026-01-06", "total3": 1030822847510.0, "dpo1w": 40.1, "dpo2w": 32.89}, {"date_str": "2026-01-07", "total3": 1038178204804.0, "dpo1w": 41.07, "dpo2w": 34.08}, {"date_str": "2026-01-08", "total3": 1011410268184.0, "dpo1w": 38.69, "dpo2w": 32.07}, {"date_str": "2026-01-09", "total3": 1003479635151.0, "dpo1w": 38.29, "dpo2w": 31.79}, {"date_str": "2026-01-10", "total3": 997032188499.0, "dpo1w": 38.01, "dpo2w": 31.37}, {"date_str": "2026-01-11", "total3": 993909192213.0, "dpo1w": 38.11, "dpo2w": 31.27}, {"date_str": "2026-01-12", "total3": 999755825045.0, "dpo1w": 39.05, "dpo2w": 32.17}, {"date_str": "2026-01-13", "total3": 997785865466.0, "dpo1w": 39.17, "dpo2w": 32.37}, {"date_str": "2026-01-14", "total3": 1034682244362.0, "dpo1w": 43.26, "dpo2w": 36.17}, {"date_str": "2026-01-15", "total3": 1030853081238.0, "dpo1w": 43.08, "dpo2w": 36.12}, {"date_str": "2026-01-16", "total3": 1012583049231.0, "dpo1w": 41.49, "dpo2w": 34.68}, {"date_str": "2026-01-17", "total3": 1016263898961.0, "dpo1w": 42.1, "dpo2w": 35.26}, {"date_str": "2026-01-18", "total3": 1014780233854.0, "dpo1w": 42.11, "dpo2w": 35.42}, {"date_str": "2026-01-19", "total3": 991762387563.0, "dpo1w": 39.95, "dpo2w": 33.59}, {"date_str": "2026-01-20", "total3": 984967742491.0, "dpo1w": 39.44, "dpo2w": 33.26}, {"date_str": "2026-01-21", "total3": 952325662031.0, "dpo1w": 36.14, "dpo2w": 30.45}, {"date_str": "2026-01-22", "total3": 965120912625.0, "dpo1w": 37.5, "dpo2w": 31.91}, {"date_str": "2026-01-23", "total3": 964226601499.0, "dpo1w": 37.4, "dpo2w": 32.1}, {"date_str": "2026-01-24", "total3": 965930274856.0, "dpo1w": 37.54, "dpo2w": 32.58}, {"date_str": "2026-01-25", "total3": 961613983106.0, "dpo1w": 37.12, "dpo2w": 32.5}, {"date_str": "2026-01-26", "total3": 933993778406.0, "dpo1w": 34.24, "dpo2w": 30.29}, {"date_str": "2026-01-27", "total3": 954430303928.0, "dpo1w": 36.31, "dpo2w": 32.58}, {"date_str": "2026-01-28", "total3": 963570719256.0, "dpo1w": 37.19, "dpo2w": 33.76}, {"date_str": "2026-01-29", "total3": 963850372402.0, "dpo1w": 37.19, "dpo2w": 34.09}, {"date_str": "2026-01-30", "total3": 930547483639.0, "dpo1w": 33.73, "dpo2w": 31.2}, {"date_str": "2026-01-31", "total3": 918611591740.0, "dpo1w": 32.47, "dpo2w": 30.35}, {"date_str": "2026-02-01", "total3": 873783450883.0, "dpo1w": 27.74, "dpo2w": 26.42}, {"date_str": "2026-02-02", "total3": 860713545095.0, "dpo1w": 26.37, "dpo2w": 25.47}, {"date_str": "2026-02-03", "total3": 873487755590.0, "dpo1w": 27.73, "dpo2w": 26.8}, {"date_str": "2026-02-04", "total3": 859539765451.0, "dpo1w": 26.2, "dpo2w": 25.55}, {"date_str": "2026-02-05", "total3": 831846869912.0, "dpo1w": 23.2, "dpo2w": 23.03}, {"date_str": "2026-02-06", "total3": 749663524468.0, "dpo1w": 14.62, "dpo2w": 15.28}, {"date_str": "2026-02-07", "total3": 815211448453.0, "dpo1w": 21.32, "dpo2w": 21.56}, {"date_str": "2026-02-08", "total3": 809874930084.0, "dpo1w": 20.71, "dpo2w": 21.17}, {"date_str": "2026-02-09", "total3": 799102765955.0, "dpo1w": 19.62, "dpo2w": 20.31}, {"date_str": "2026-02-10", "total3": 807742814554.0, "dpo1w": 20.55, "dpo2w": 21.32}, {"date_str": "2026-02-11", "total3": 796897745348.0, "dpo1w": 19.53, "dpo2w": 20.44}, {"date_str": "2026-02-12", "total3": 788326372934.0, "dpo1w": 18.68, "dpo2w": 19.75}, {"date_str": "2026-02-13", "total3": 790150103169.0, "dpo1w": 18.94, "dpo2w": 20.0}, {"date_str": "2026-02-14", "total3": 805967505068.0, "dpo1w": 20.6, "dpo2w": 21.48}, {"date_str": "2026-02-15", "total3": 826964857550.0, "dpo1w": 22.76, "dpo2w": 23.48}, {"date_str": "2026-02-16", "total3": 813739406213.0, "dpo1w": 21.47, "dpo2w": 22.25}, {"date_str": "2026-02-17", "total3": 816510002947.0, "dpo1w": 21.72, "dpo2w": 22.5}, {"date_str": "2026-02-18", "total3": 813724555031.0, "dpo1w": 21.32, "dpo2w": 22.28}, {"date_str": "2026-02-19", "total3": 801065902084.0, "dpo1w": 19.98, "dpo2w": 21.13}, {"date_str": "2026-02-20", "total3": 800759944500.0, "dpo1w": 20.02, "dpo2w": 21.09}, {"date_str": "2026-02-21", "total3": 811722971449.0, "dpo1w": 21.25, "dpo2w": 22.13}];
// ‚îÄ‚îÄ COINGECKO API KEY ‚îÄ‚îÄ
const CG_API_KEY = 'CG-dJVxAwDLgzBr93UYBNLwqTJZ';
function cgHeaders(){ return {}; } // no custom headers ‚Äî avoids CORS preflight
function cgUrl(path){
  // Pass key as query param ‚Äî avoids preflight CORS block
  const sep = path.includes('?') ? '&' : '?';
  return 'https://api.coingecko.com/api/v3' + path + sep + 'x_cg_demo_api_key=' + CG_API_KEY;
}

const CG_IDS = {"BTC": "bitcoin", "ETH": "ethereum", "XRP": "ripple", "QNT": "quant-network", "TAO": "bittensor", "CC": "canton-network", "XLM": "stellar", "HBAR": "hedera-hashgraph", "XDC": "xdce-crowd-sale", "ALGO": "algorand", "IOTA": "iota", "AERO": "aerodrome-finance", "FLR": "flare-network", "ZORA": "zora"};

const TIER_ORDER = ['REFERENCE','CORE','TIER1','TIER2'];
const TIER_GRID = {REFERENCE:'ref-grid', CORE:'core-grid', TIER1:'t1-grid', TIER2:'t2-grid'};

let liveData = {};
let hotAssets = [];
let hiddenAssets = [];

// Init liveData from seed
function initFromSeed(){
  for(const[t,d] of Object.entries(ASSET_SEED)){
    liveData[t] = JSON.parse(JSON.stringify(d));
    if(d.hot && !hotAssets.includes(t)) hotAssets.push(t);
  }
}

// ‚îÄ‚îÄ UTILITIES ‚îÄ‚îÄ
function fmt(p){
  if(!p&&p!==0)return'--';
  if(p>=10000)return'$'+Math.round(p).toLocaleString();
  if(p>=1000) return'$'+p.toFixed(1);
  if(p>=1)    return'$'+p.toFixed(3);
  if(p>=0.01) return'$'+p.toFixed(4);
  return'$'+p.toFixed(5);
}
function fc(v){return v<30?'fill-low':v<70?'fill-mid':'fill-high';}
function cc(v){return v<30?'col-low':v<70?'col-mid':'col-high';}
function subLabel(v){
  if(v<25)return['rsub-floor','AT FLOOR'];
  if(v<45)return['rsub-low','LOW RANGE'];
  if(v<65)return['rsub-mid','MID RANGE'];
  if(v<80)return['rsub-high','HIGH'];
  return['rsub-peak','NEAR PEAK'];
}

// ‚îÄ‚îÄ DPO ‚îÄ‚îÄ
function calcDPO(closes,period){
  const shift=Math.floor(period/2)+1;
  const r=new Array(closes.length).fill(null);
  for(let i=period+shift-1;i<closes.length;i++){
    let s=0;for(let j=i-period+1-shift;j<=i-shift;j++)s+=closes[j];
    r[i]=closes[i-shift]-s/period;
  }
  return r;
}
function normLifetime(raw){
  const r=new Array(raw.length).fill(50);
  let mn=Infinity,mx=-Infinity;
  for(let i=0;i<raw.length;i++){
    if(raw[i]===null)continue;
    if(raw[i]<mn)mn=raw[i];if(raw[i]>mx)mx=raw[i];
    r[i]=mx>mn?(raw[i]-mn)/(mx-mn)*100:50;
  }
  return r;
}
function trend(arr,days=5){
  const v=arr.filter(x=>x!==null);
  if(v.length<days+2)return'flat';
  return v[v.length-1]>v[v.length-1-days]?'up':'down';
}
function assetDPOs(closes){
  if(!closes||closes.length<60)return null;
  const out={l2:{},l3:{}};
  for(const[k,p]of[['1d',5],['3d',15],['1w',40],['2w',60]]){
    const n=normLifetime(calcDPO(closes,p));
    out.l2[k]={val:Math.round(n[n.length-1]*10)/10,trend:trend(n)};
  }
  for(const[k,p]of[['2h',5],['4h',7],['8h',10],['12h',14]]){
    const n=normLifetime(calcDPO(closes,p));
    out.l3[k]={val:Math.round(n[n.length-1]*10)/10,trend:trend(n)};
  }
  return out;
}
function getSignal(w1,w2){
  if(w1<25&&w2<25)return'ACCUMULATE';
  if(w1<35&&w2<35)return'WATCH_ENTRY';
  if(w1>70||w2>70)return'EXTENDED';
  return'MONITOR';
}
function l3Score(l3){
  return['2h','4h','8h','12h'].reduce((s,k)=>s+(l3[k].val<30&&l3[k].trend==='up'?1:0),0);
}
function l3State(l3,score){
  if(score>=3)return'ENTRY_NOW';
  if(score===2)return'NEAR';
  if(['2h','4h','8h','12h'].every(k=>l3[k].val<35))return'AT_FLOOR';
  return'WAIT';
}
function makeAlert(sig,l3st,l2,l3){
  const w1v=l2['1w'].val,w2v=l2['2w'].val,w1t=l2['1w'].trend,w2t=l2['2w'].trend;
  if(sig==='ACCUMULATE'){
    if(l3st==='ENTRY_NOW')return'üü¢ TRIGGER ACTIVE ‚Äî 4H proxy at floor and turning ‚Üë. All 3 layers aligned.';
    if(l3st==='AT_FLOOR') return`‚è≥ Gate open. Waiting for 4H proxy (${l3['4h'].val.toFixed(0)}) to drop below 30 and turn ‚Üë.`;
    if(w1t==='down'&&w2t==='down')return'‚ö†Ô∏è Gate open but 1W + 2W both still declining. Watching for floor to confirm.';
    return`‚úÖ Gate open. 1W: ${w1v} ¬∑ 2W: ${w2v} ‚Äî in accumulation zone. Watching for Layer 3 trigger.`;
  }
  if(sig==='WATCH_ENTRY')return`üëÄ Approaching. 1W: ${w1v}, 2W: ${w2v}. Need both below 25 for ACCUMULATE.`;
  if(sig==='EXTENDED')   return`‚ö†Ô∏è Cycle elevated. 1W: ${w1v}, 2W: ${w2v}. Not a buy zone ‚Äî consider reducing exposure.`;
  return`‚è≥ Monitoring. 1W: ${w1v}, 2W: ${w2v}. Waiting for cycle to develop toward floor.`;
}

// Signal tooltip HTML
const SIG_STATES = [
  {k:'ACCUMULATE', cls:'sig-ACCUMULATE', desc:'1W + 2W both below 25 ‚Äî cycle at floor, buy zone active.'},
  {k:'WATCH ENTRY',cls:'sig-WATCH_ENTRY',desc:'1W + 2W both below 35 ‚Äî approaching floor, prepare for entry.'},
  {k:'MONITOR',    cls:'sig-MONITOR',    desc:'One or both between 35‚Äì70 ‚Äî mid-cycle, nothing actionable yet.'},
  {k:'EXTENDED',   cls:'sig-EXTENDED',   desc:'One or both above 70 ‚Äî cycle elevated, not a buy zone. Consider reducing exposure.'},
];
function sigTooltipHTML(activeSig){
  const rows=SIG_STATES.map(s=>{
    const active=s.k.replace(' ','_')===activeSig||s.k===activeSig;
    return`<div class="sig-tt-row${active?' active-sig':''}">
      <span class="sig-tt-label ${s.cls}">${s.k}</span>
      <span class="sig-tt-text">${s.desc}</span>
    </div>`;
  }).join('');
  return`<div class="sig-tooltip"><div class="sig-tt-title">SIGNAL STATES</div>${rows}</div>`;
}


// State tooltip HTML
const L3_STATES = [
  {k:'ENTRY NOW', state:'ENTRY_NOW', cls:'state-ENTRY_NOW', desc:'Score 3‚Äì4/4: Multiple sub-daily proxies at floor and turning ‚Üë simultaneously. Highest precision entry signal ‚Äî all layers aligned.'},
  {k:'NEAR',      state:'NEAR',      cls:'state-NEAR',      desc:'Score 2/4: Two proxies aligned and turning. Getting close ‚Äî watch for the 4H to join for full confirmation.'},
  {k:'AT FLOOR',  state:'AT_FLOOR',  cls:'state-AT_FLOOR',  desc:'All four proxies below 35 but not yet turning up. Sitting at the bottom of the cycle, waiting for the reversal.'},
  {k:'TURNING',   state:'TURNING',   cls:'state-TURNING',   desc:'Proxies starting to turn upward from low levels. The trigger is developing ‚Äî watch the 4H indicator closely.'},
  {k:'WAIT',      state:'WAIT',      cls:'state-WAIT',      desc:'Proxies not yet at floor or not yet turning. No Layer 3 signal present. Monitor and wait for cycle to develop.'},
];
function stateTooltipHTML(activeState){
  const rows=L3_STATES.map(s=>{
    const active=s.state===activeState;
    return'<div class="st-row'+(active?' active-state':'')+'">'
      +'<span class="st-key '+s.cls+'">'+s.k+'</span>'
      +'<span class="st-desc">'+s.desc+'</span>'
      +'</div>';
  }).join('');
  const chipTxt=activeState.replace(/_/g,' ');
  return'<div class="state-chip '+('state-'+activeState)+'" style="cursor:help;border-bottom:1px dashed rgba(255,255,255,0.15)">'+chipTxt+'</div>'
    +'<div class="state-tooltip"><div class="st-title">LAYER 3 STATES</div>'+rows+'</div>';
}

// ‚îÄ‚îÄ BUILD CARD ‚îÄ‚îÄ
function buildCard(ticker,isHot=false){
  const a=liveData[ticker];
  const sig=getSignal(a.l2['1w'].val,a.l2['2w'].val);
  const score=l3Score(a.l3);
  const l3st=l3State(a.l3,score);
  const alert=makeAlert(sig,l3st,a.l2,a.l3);

  const maColor=a.ma200_pct!=null?(a.ma200_pct<0?'var(--red)':'var(--green)'):'var(--sub)';
  const maStr=a.ma200_pct!=null?`${a.ma200_pct>0?'+':''}${a.ma200_pct}% vs 200MA`:'no 200MA data';

  const TIER_STYLES={
    REFERENCE:{color:'var(--sub)',   bg:'rgba(122,112,96,0.12)'},
    CORE:     {color:'var(--amber)', bg:'rgba(255,170,0,0.15)'},
    TIER1:    {color:'var(--blue)',  bg:'rgba(85,153,255,0.12)'},
    TIER2:    {color:'var(--cyan)',  bg:'rgba(0,204,221,0.10)'},
  };
  const ts=TIER_STYLES[a.tier]||TIER_STYLES.TIER2;
  const tierLabel=a.tier==='TIER1'?'TIER 1':a.tier==='TIER2'?'TIER 2':a.tier;

  const l2rows=['1d','3d','1w','2w'].map(k=>{
    const v=a.l2[k].val,t=a.l2[k].trend,isKey=k==='1w'||k==='2w';
    return`<div class="bar-row">
      <div class="bar-lbl${isKey?' key':''}">${k.toUpperCase()}</div>
      <div class="bar-track"><div class="bar-fill ${fc(v)}" style="width:${v}%"></div></div>
      <div class="bar-val ${cc(v)}">${v.toFixed(1)}</div>
      <div class="bar-arr ${t==='up'?'up':'dn'}">${t==='up'?'‚Üë':'‚Üì'}</div>
    </div>`;
  }).join('');

  const l3cells=['2h','4h','8h','12h'].map(k=>{
    const v=a.l3[k].val,t=a.l3[k].trend,is4h=k==='4h',firing=is4h&&v<30&&t==='up';
    return`<div class="l3-cell${is4h?' key':''}${firing?' firing':''}">
      <div class="l3-top">
        <div class="l3-name${is4h?' key-lbl':''}">${k.toUpperCase()}${is4h?' ‚òÖ':''}</div>
        <div class="l3-arr ${t==='up'?'up':'dn'}">${t==='up'?'‚Üë':'‚Üì'}</div>
      </div>
      <div class="l3-bar"><div class="l3-fill ${fc(v)}" style="width:${v}%"></div></div>
      <div class="l3-val ${cc(v)}">${v.toFixed(1)}</div>
    </div>`;
  }).join('');

  const dots=[0,1,2,3].map(i=>`<div class="dot ${i<score?'on':'off'}"></div>`).join('');
  const hotBtnTxt=isHot?'‚úï HOT':'üî• HOT';

  return`<div class="card${isHot?' hot-card':''}" data-ticker="${ticker}"
    draggable="true" ondragstart="onDragStart(event)" ondragover="onDragOver(event)"
    ondrop="onDrop(event)" ondragleave="onDragLeave(event)" ondragend="onDragEnd(event)">
    <div class="drag-handle" title="Drag to reorder">‚†ø</div>
    <button class="hot-toggle" title="${isHot?'Remove from Hot Cards':'Add to Hot Cards'}"
      onclick="toggleHot('${ticker}',event)">${hotBtnTxt}</button>
    <div class="stripe stripe-${sig}"></div>
    <div class="card-head">
      <div class="ticker-row">
        <div class="ticker-left">
          <div class="ticker">${ticker}</div>
          <div class="price">${fmt(a.price)}</div>
        </div>
        <div class="sig-wrap">
          <div class="sig-pill sig-${sig}">${sig.replace('_',' ')}</div>
          ${sigTooltipHTML(sig)}
        </div>
      </div>
      <div class="fullname">${a.fullname}</div>
      <div class="badge-row">
        <span class="ma-badge" style="color:${maColor}">${maStr}</span>
        ${a.limited?'<span class="lim-badge">‚ö† LIMITED HISTORY</span>':''}
        ${isHot?'<span class="hot-badge">üî• HOT</span>':''}
        <span class="tier-badge" style="color:${ts.color};background:${ts.bg}">${tierLabel}</span>
      </div>
    </div>
    <div class="divider"></div>
    <div class="l2">
      <div class="layer-title" style="color:var(--blue)">
        <span class="layer-title-bar" style="background:var(--blue)"></span>
        LAYER 2 ‚Äî DIRECTION
      </div>
      ${l2rows}
      <div class="arr-legend">
        <span><span class="up">‚Üë</span> rising (5d)</span>
        <span><span class="dn">‚Üì</span> falling (5d)</span>
      </div>
    </div>
    <div class="l3">
      <div class="layer-title" style="color:var(--purple)">
        <span class="layer-title-bar" style="background:var(--purple)"></span>
        LAYER 3 ‚Äî ENTRY PRECISION
      </div>
      <div class="l3-grid">${l3cells}</div>
    </div>
    <div class="score-row">
      <div style="display:flex;align-items:center;gap:8px;">
        <div style="font-size:9px;font-family:'Space Mono',monospace;color:var(--sub)">CONFLUENCE</div>
        <div class="dots">${dots}</div>
        <div style="font-size:10px;font-family:'Space Mono',monospace;color:var(--purple);font-weight:700">${score}/4</div>
      </div>
      <div class="state-wrap">${stateTooltipHTML(l3st)}</div>
    </div>
    <div class="alert-row">${alert}</div>
  </div>`;
}

// ‚îÄ‚îÄ RENDER ‚îÄ‚îÄ
function renderAll(){
  // Hot cards
  const hg=document.getElementById('hot-grid');
  const visHot=hotAssets.filter(t=>!hiddenAssets.includes(t));
  hg.innerHTML=visHot.length
    ? visHot.map(t=>buildCard(t,true)).join('')
    : `<div class="drop-zone" ondragover="event.preventDefault();this.classList.add('drag-active')"
        ondragleave="this.classList.remove('drag-active')"
        ondrop="onDropToHot(event)">DRAG A CARD HERE TO ADD TO HOT CARDS</div>`;

  // Tier grids
  const allTiers=['REFERENCE','CORE','TIER1','TIER2','WATCHLIST'];
  const allGrids={REFERENCE:'ref-grid',CORE:'core-grid',TIER1:'t1-grid',TIER2:'t2-grid',WATCHLIST:'watch-grid'};
  for(const tier of allTiers){
    const grid=document.getElementById(allGrids[tier]);
    if(!grid)continue;
    const cards=Object.keys(liveData)
      .filter(t=>liveData[t].tier===tier&&!hotAssets.includes(t)&&!hiddenAssets.includes(t));
    grid.innerHTML=cards.map(t=>buildCard(t,false)).join('');
  }
  updateSectionHeaders();
}

// ‚îÄ‚îÄ GATE UI ‚îÄ‚îÄ
function updateGateUI(g){
  const{total3,v1w,v2w,t1w,t2w}=g;
  const isOpen=v1w<30&&v2w<30;
  const isWarnShort=v1w>70||v2w>70;

  document.getElementById('gate-led').className='gate-led '+(isOpen?'open':isWarnShort?'warning':'closed');
  const st=document.getElementById('gate-status-text');
  if(isOpen){st.textContent='ACCUMULATE ‚Äî GATE OPEN';st.style.color='var(--amber)';}
  else if(isWarnShort){st.textContent='WAIT / CONSIDER SHORT';st.style.color='var(--red)';}
  else{st.textContent='MONITORING ‚Äî NOT AT FLOOR YET';st.style.color='var(--sub)';}

  document.getElementById('gate-1w').textContent=v1w.toFixed(1);
  document.getElementById('gate-2w').textContent=v2w.toFixed(1);
  document.getElementById('gate-1w-trend').innerHTML=`<span class="${t1w==='up'?'up':'dn'}">${t1w==='up'?'‚Üë':'‚Üì'}</span>`;
  document.getElementById('gate-2w-trend').innerHTML=`<span class="${t2w==='up'?'up':'dn'}">${t2w==='up'?'‚Üë':'‚Üì'}</span>`;

  const[cls1w,lbl1w]=subLabel(v1w);
  const[cls2w,lbl2w]=subLabel(v2w);
  const s1=document.getElementById('gate-1w-sub'),s2=document.getElementById('gate-2w-sub');
  s1.className='reading-sub '+cls1w;s1.textContent=lbl1w;
  s2.className='reading-sub '+cls2w;s2.textContent=lbl2w;
  if(total3)document.getElementById('gate-t3').textContent='$'+(total3/1e9).toFixed(0)+'B';

  let desc='';
  if(isOpen) desc=`Both 1W (${v1w.toFixed(1)}) and 2W (${v2w.toFixed(1)}) at lifetime floors ‚Äî universal altcoin accumulation window active. Historical precedent: July 2024 dual-floor preceded +100% altcoin market cap move.`;
  else if(isWarnShort) desc=`‚ö†Ô∏è 1W (${v1w.toFixed(1)}) or 2W (${v2w.toFixed(1)}) above 70 ‚Äî early warning zone. Exit longs, consider shorts. Higher reliability signal when both approach 83‚Äì90 (historical peak zone).`;
  else desc=`1W at ${v1w.toFixed(1)}, 2W at ${v2w.toFixed(1)}. Not yet at dual-floor buy zone. Gate opens fully when both drop below ~25 simultaneously.`;
  document.getElementById('gate-desc').textContent=desc;
  document.getElementById('gate-updated').textContent='Updated '+new Date().toLocaleTimeString();
}

// ‚îÄ‚îÄ COINGECKO FETCH ‚îÄ‚îÄ
async function fetchCGPrices(){
  const ids=Object.values(CG_IDS).join(',');
  const r=await fetch(cgUrl(`/simple/price?ids=${ids}&vs_currencies=usd`),{headers:cgHeaders()});
  if(!r.ok)throw new Error('CG prices '+r.status);
  return await r.json();
}
async function fetchCGHistory(cgId,days=500){
  const r=await fetch(cgUrl(`/coins/${cgId}/market_chart?vs_currency=usd&days=${days}&interval=daily`),{headers:cgHeaders()});
  if(!r.ok)throw new Error('CG hist '+cgId+' '+r.status);
  return (await r.json()).prices.map(p=>p[1]);
}
async function fetchCGGlobal(){
  const r=await fetch(cgUrl('/global'),{headers:cgHeaders()});
  if(!r.ok)throw new Error('CG global '+r.status);
  return (await r.json()).data;
}
async function computeTotal3Gate(){
  const g=await fetchCGGlobal();
  const total=g.total_market_cap.usd;
  const t3=total-total*g.market_cap_percentage.btc/100-total*g.market_cap_percentage.eth/100;
  const closes=TOTAL3_SEED.map(d=>d.total3);
  const today=new Date().toISOString().slice(0,10);
  if(TOTAL3_SEED[TOTAL3_SEED.length-1].date_str!==today)closes.push(t3);
  else closes[closes.length-1]=t3;
  const n1w=normLifetime(calcDPO(closes,40));
  const n2w=normLifetime(calcDPO(closes,60));
  return{total3:t3,v1w:Math.round(n1w[n1w.length-1]*10)/10,v2w:Math.round(n2w[n2w.length-1]*10)/10,
    t1w:trend(n1w),t2w:trend(n2w)};
}

// ‚îÄ‚îÄ DRAG & DROP ‚îÄ‚îÄ
let dragTicker=null;
function onDragStart(e){dragTicker=e.currentTarget.dataset.ticker;setTimeout(()=>e.currentTarget.classList.add('dragging'),0);e.dataTransfer.effectAllowed='move';}
function onDragEnd(e){e.currentTarget.classList.remove('dragging');}
function onDragOver(e){e.preventDefault();e.currentTarget.classList.add('drag-over');}
function onDragLeave(e){e.currentTarget.classList.remove('drag-over');}
function onDropToHot(e){
  e.preventDefault();e.currentTarget.classList.remove('drag-active');
  if(!dragTicker||hotAssets.includes(dragTicker))return;
  hotAssets.push(dragTicker);renderAll();
}
function onDrop(e){
  e.preventDefault();e.currentTarget.classList.remove('drag-over');
  const target=e.currentTarget.dataset.ticker;
  if(!dragTicker||dragTicker===target)return;
  const dragHot=hotAssets.includes(dragTicker),targetHot=hotAssets.includes(target);
  if(dragHot&&!targetHot){hotAssets=hotAssets.filter(t=>t!==dragTicker);}
  else if(!dragHot&&targetHot){if(!hotAssets.includes(dragTicker))hotAssets.push(dragTicker);}
  renderAll();dragTicker=null;
}
function toggleHot(ticker,e){
  e.stopPropagation();
  if(hotAssets.includes(ticker))hotAssets=hotAssets.filter(t=>t!==ticker);
  else hotAssets.push(ticker);
  renderAll();
}

// ‚îÄ‚îÄ TIER HEADER TICKER UPDATE ‚îÄ‚îÄ
const TIER_TICKER_IDS = {
  REFERENCE:'ref-tickers', CORE:'core-tickers',
  TIER1:'t1-tickers', TIER2:'t2-tickers', WATCHLIST:'watch-tickers'
};
function updateSectionHeaders(){
  for(const[tier,elId] of Object.entries(TIER_TICKER_IDS)){
    const el=document.getElementById(elId);
    if(!el)continue;
    const tickers=Object.keys(liveData)
      .filter(t=>liveData[t].tier===tier&&!hotAssets.includes(t)&&!hiddenAssets.includes(t));
    el.textContent=tickers.length?tickers.join(' ¬∑ '):'‚Äî empty ‚Äî';
  }
  const hotEl=document.getElementById('hot-tickers');
  if(hotEl)hotEl.textContent=hotAssets.filter(t=>!hiddenAssets.includes(t)).join(' ¬∑ ')||'‚Äî empty ‚Äî';
}

// ‚îÄ‚îÄ MODAL STATE ‚îÄ‚îÄ
let modalTier='WATCHLIST';
let modalTicker='';
let modalName='';
let modalSlug='';
let modalCSVData=null;
let modalSkipCSV=false;
const TIER_STYLES_MAP={"CORE": {"color": "var(--amber)", "bg": "rgba(255,170,0,0.15)", "label": "CORE"}, "TIER1": {"color": "var(--blue)", "bg": "rgba(85,153,255,0.12)", "label": "TIER 1"}, "TIER2": {"color": "var(--cyan)", "bg": "rgba(0,204,221,0.10)", "label": "TIER 2"}, "WATCHLIST": {"color": "var(--purple)", "bg": "rgba(176,136,255,0.15)", "label": "WATCHLIST"}, "REFERENCE": {"color": "#a09080", "bg": "rgba(122,112,96,0.15)", "label": "REFERENCE"}};

function tierStepLabel(tier,elId){
  const ts=TIER_STYLES_MAP[tier]||TIER_STYLES_MAP.WATCHLIST;
  return '<span id="'+elId+'" class="modal-step-label" style="background:'+ts.bg+';color:'+ts.color+'">ADDING TO '+ts.label+'</span>';
}
function openAddModal(tier){
  modalTier=tier; modalTicker=''; modalName=''; modalSlug=''; modalCSVData=null; modalSkipCSV=false;
  document.getElementById('inp-ticker').value='';
  document.getElementById('inp-name').value='';
  document.getElementById('inp-slug').value='';
  const res=document.getElementById('csv-result');
  if(res)res.style.display='none';
  const btn=document.getElementById('btn-add');
  if(btn)btn.disabled=true;
  ['modal-step-label','modal-step-label2','modal-step-label3'].forEach(id=>{
    const el=document.getElementById(id);
    if(el){const tmp=document.createElement('div');tmp.innerHTML=tierStepLabel(tier,id);el.replaceWith(tmp.firstChild);}
  });
  showStep(1);
  document.getElementById('modal-overlay').classList.add('open');
}
function showStep(n){
  ['step1','step2','step3'].forEach((id,i)=>{
    document.getElementById(id).style.display=(i+1===n)?'':'none';
  });
}
function autoSlug(){
  const t=document.getElementById('inp-ticker').value.trim().toLowerCase();
  const known={hbar:'hedera-hashgraph',xdc:'xdce-crowd-sale',tao:'bittensor',
    aero:'aerodrome-finance',flr:'flare-network',xlm:'stellar',qnt:'quant-network',
    xrp:'ripple',btc:'bitcoin',eth:'ethereum',algo:'algorand',iota:'iota',
    cc:'canton-network',zora:'zora'};
  const slug=known[t]||t.replace(/[^a-z0-9]/g,'-');
  document.getElementById('inp-slug').value=slug;
  updateLinks();
}
function updateLinks(){
  const slug=document.getElementById('inp-slug').value.trim()||'your-coin';
  const ticker=document.getElementById('inp-ticker').value.trim().toUpperCase()||'COIN';
  const dl=document.getElementById('link-direct');
  const sl=document.getElementById('link-search');
  if(dl){dl.href='https://www.coingecko.com/en/coins/'+slug+'/historical_data';dl.textContent='coingecko.com/en/coins/'+slug+'/historical_data';}
  if(sl){sl.href='https://www.coingecko.com/en/search?query='+ticker;sl.textContent='coingecko.com/en/search?query='+ticker;}
}
function goStep1(){showStep(1);}
function goStep2(){
  const ticker=document.getElementById('inp-ticker').value.trim().toUpperCase();
  const name=document.getElementById('inp-name').value.trim();
  const slug=document.getElementById('inp-slug').value.trim().toLowerCase();
  if(!ticker){alert('Please enter a ticker symbol.');return;}
  if(!name){alert('Please enter the full asset name.');return;}
  if(!slug){alert('Please enter the CoinGecko slug.');return;}
  if(liveData[ticker]){alert(ticker+' is already on the dashboard.');return;}
  modalTicker=ticker; modalName=name; modalSlug=slug;
  updateLinks();
  showStep(2);
}
function goStep3(skip){
  modalSkipCSV=skip;
  if(skip){finalizeAdd();return;}
  const res=document.getElementById('csv-result');
  if(res)res.style.display='none';
  const btn=document.getElementById('btn-add');
  if(btn)btn.disabled=true;
  showStep(3);
}
function validateCSV(input){
  const file=input.files[0];
  if(!file)return;
  const reader=new FileReader();
  reader.onload=function(e){
    const rawText=e.target.result;
    const lines=rawText.trim().split('\n').filter(l=>l.trim());
    const header=lines[0].toLowerCase();
    const resultEl=document.getElementById('csv-result');
    resultEl.style.display='block';
    if(!header.includes('price')||(!header.includes('snapped_at')&&!header.includes('date'))){
      resultEl.className='csv-err';
      resultEl.innerHTML='‚ùå Invalid file format ‚Äî expected CoinGecko CSV with date and price columns.<br>Please re-download from CoinGecko.';
      document.getElementById('btn-add').disabled=true;
      return;
    }
    const dataLines=lines.slice(1).filter(l=>l.trim());
    const rowCount=dataLines.length;
    function parseRow(line){
      const parts=line.split(',');
      return{date:parts[0]?parts[0].trim().slice(0,10):'?',price:parts[1]?parseFloat(parts[1]):null};
    }
    const first=parseRow(dataLines[0]);
    const last=parseRow(dataLines[dataLines.length-1]);
    const lastPrice=last.price;
    if(rowCount<30){
      resultEl.className='csv-err';
      resultEl.innerHTML='‚ö†Ô∏è Only '+rowCount+' rows found ‚Äî very limited history.';
      document.getElementById('btn-add').disabled=true;
    } else {
      resultEl.className='csv-ok';
      resultEl.innerHTML=
        '<span style="color:var(--green)">‚úÖ File looks good</span>\n\n'+
        'Rows:       '+rowCount+' daily closes\n'+
        'Date range: '+first.date+' ‚Üí '+last.date+'\n'+
        'Last price: $'+(lastPrice?lastPrice.toFixed(6):'?')+'\n\n'+
        '<span style="color:var(--sub)">Verify last price matches CoinGecko current price.\nIf correct, click Add Card.</span>';
      modalCSVData={rawText, rowCount, firstDate:first.date, lastDate:last.date, lastPrice};
      document.getElementById('btn-add').disabled=false;
    }
  };
  reader.readAsText(file);
}
function finalizeAdd(){
  const tier=modalTier;
  const ticker=modalTicker;
  liveData[ticker]={
    fullname:modalName, tier:tier, hot:false,
    price:0, ma200_pct:null,
    limited:!modalCSVData||(modalCSVData&&modalCSVData.rowCount<200),
    nrows:modalCSVData?modalCSVData.rowCount:0,
    signal:'MONITOR', cgId:modalSlug,
    l2:{'1d':{val:50,trend:'flat'},'3d':{val:50,trend:'flat'},'1w':{val:50,trend:'flat'},'2w':{val:50,trend:'flat'}},
    l3:{'2h':{val:50,trend:'flat'},'4h':{val:50,trend:'flat'},'8h':{val:50,trend:'flat'},'12h':{val:50,trend:'flat'}},
    score:0, l3_state:'WAIT',
    alert:'‚è≥ Card added ‚Äî fetching live data...',
    csvText:modalCSVData?modalCSVData.rawText:null,
  };
  CG_IDS[ticker]=modalSlug;
  closeModal();
  renderAll();
  updateSectionHeaders();
  fetchAndUpdateAsset(ticker);
}
function closeModal(){
  document.getElementById('modal-overlay').classList.remove('open');
}
function openModal(){openAddModal('TIER1');}

// ‚îÄ‚îÄ FETCH SINGLE ASSET ‚îÄ‚îÄ
async function fetchAndUpdateAsset(ticker){
  const cgId=CG_IDS[ticker];
  if(!cgId)return;
  try{
    const closes=await fetchCGHistory(cgId, liveData[ticker].limited?365:500);
    if(closes.length<30)return;
    const price=closes[closes.length-1];
    liveData[ticker].price=price;
    if(closes.length>=200){
      const ma200=closes.slice(-200).reduce((a,b)=>a+b,0)/200;
      liveData[ticker].ma200_pct=Math.round((price-ma200)/ma200*100*10)/10;
    }
    const dpores=assetDPOs(closes);
    if(dpores){liveData[ticker].l2=dpores.l2;liveData[ticker].l3=dpores.l3;}
    liveData[ticker].signal=getSignal(liveData[ticker].l2['1w'].val,liveData[ticker].l2['2w'].val);
    liveData[ticker].alert=makeAlert(liveData[ticker].signal,liveData[ticker].l3_state,liveData[ticker].l2,liveData[ticker].l3);
    renderAll();
    updateSectionHeaders();
  }catch(ex){console.warn('fetchAndUpdateAsset '+ticker+':',ex.message);}
}

// ‚îÄ‚îÄ MAIN REFRESH ‚îÄ‚îÄ
async function refreshAll(silent=false){
  const ico=document.getElementById('refresh-ico');
  const dot=document.getElementById('status-dot');
  const stxt=document.getElementById('status-text');
  ico.classList.add('spinning');dot.className='status-dot fetching';stxt.textContent='Fetching...';
  let errors=0,updated=0;

  try{const g=await computeTotal3Gate();updateGateUI(g);}
  catch(ex){console.warn('TOTAL3:',ex.message);errors++;
    updateGateUI({total3:null,v1w:21.3,v2w:22.1,t1w:'down',t2w:'down'});}

  for(const[ticker,cgId]of Object.entries(CG_IDS)){
    try{
      stxt.textContent=`Fetching ${ticker}...`;
      const closes=await fetchCGHistory(cgId, liveData[ticker].limited?365:500);
      if(closes.length<30){errors++;continue;}
      const price=closes[closes.length-1];
      liveData[ticker].price=price;
      if(closes.length>=200){
        const ma200=closes.slice(-200).reduce((a,b)=>a+b,0)/200;
        liveData[ticker].ma200_pct=Math.round((price-ma200)/ma200*100*10)/10;
      }
      const dpores=assetDPOs(closes);
      if(dpores){liveData[ticker].l2=dpores.l2;liveData[ticker].l3=dpores.l3;}
      updated++;
    }catch(ex){console.warn(ticker+':',ex.message);errors++;}
  }

  renderAll();
  ico.classList.remove('spinning');
  const now=new Date();
  dot.className=errors===0?'status-dot live':(updated>0?'status-dot stale':'status-dot error');
  if(errors===0){
    stxt.textContent='Live ¬∑ '+now.toLocaleTimeString();
  } else if(updated===0){
    stxt.textContent='No live data ‚Äî showing seed values';
    // Show the data warning banner
    const wb=document.getElementById('data-warning');
    if(wb)wb.style.display='flex';
  } else {
    stxt.textContent=updated+' live ¬∑ '+errors+' using seed';
    const wb=document.getElementById('data-warning');
    if(wb){wb.style.display='flex';wb.querySelector('.dw-msg').textContent=errors+' asset(s) could not fetch live data and are showing seed values from Feb 21, 2026.';}
  }
  document.getElementById('footer-time').textContent='Last updated: '+now.toLocaleString();
  if(!silent)document.getElementById('loading-overlay').style.display='none';
  // If all failed on first load, show warning immediately
  if(!silent && updated===0 && errors>0){
    const wb=document.getElementById('data-warning');
    if(wb)wb.style.display='flex';
  }
}

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
window.addEventListener('load',async()=>{
  initFromSeed();
  renderAll();
  updateSectionHeaders();
  updateGateUI({total3:811722971449,v1w:21.3,v2w:22.1,t1w:'down',t2w:'down'});
  await refreshAll(false);
});
setInterval(()=>refreshAll(true),30*60*1000);
</script>

<div id="loading-overlay" style="position:fixed;inset:0;background:rgba(20,20,20,0.88);z-index:999;
  display:flex;flex-direction:column;align-items:center;justify-content:center;gap:14px;">
  <div style="width:34px;height:34px;border:3px solid #2e2e2e;border-top-color:var(--amber);
    border-radius:50%;animation:spin .8s linear infinite;"></div>
  <div style="font-family:'Space Mono',monospace;font-size:12px;color:#7a7060;">
    Dr. Bob's MCAT v4 ¬∑ Fetching Live Data...
  </div>
</div>
</body>
</html>